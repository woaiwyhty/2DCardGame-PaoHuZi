window.__require=function e(t,n,i){function o(r,a){if(!n[r]){if(!t[r]){var c=r.split("/");if(c=c[c.length-1],!t[c]){var d="function"==typeof __require&&__require;if(!a&&d)return d(c,!0);if(s)return s(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var l=n[r]={exports:{}};t[r][0].call(l.exports,function(e){return o(t[r][1][e]||e)},l,l.exports,e,t,n,i)}return n[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<i.length;r++)o(i[r]);return o}({Alert:[function(e,t){"use strict";cc._RF.push(t,"8d711wD+99JZLDcFizBmkPy","Alert"),cc.Class({extends:cc.Component,properties:{_alert:null,_btnOK:null,_btnCancel:null,_title:null,_content:null,_onok:null},onLoad:function(){null!=cc.utils&&(this._alert=cc.find("Canvas/alert"),this._title=cc.find("Canvas/alert/title").getComponent(cc.Label),this._content=cc.find("Canvas/alert/content").getComponent(cc.Label),this._btnOK=cc.find("Canvas/alert/btn_ok"),this._btnCancel=cc.find("Canvas/alert/btn_cancel"),cc.utils.main.addClickEvent(this._btnOK,this.node,"Alert","onBtnClicked"),cc.utils.main.addClickEvent(this._btnCancel,this.node,"Alert","onBtnClicked"),this._alert.active=!1,cc.utils.alert=this,console.log(cc.utils.alert))},onBtnClicked:function(e){"btn_ok"==e.target.name&&this._onok&&this._onok(),this._alert.active=!1,this._onok=null},show:function(e,t,n,i){this._alert.active=!0,this._onok=n,this._title.string=e,this._content.string=t,i?(this._btnCancel.active=!0,this._btnOK.x=-150,this._btnCancel.x=150):(this._btnCancel.active=!1,this._btnOK.x=0)},onDestory:function(){cc.utils&&(cc.utils.alert=null)}}),cc._RF.pop()},{}],AppStart:[function(e,t){"use strict";cc._RF.push(t,"464efWj9iVHTL1j6J886qXv","AppStart"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},start:function(){this.scheduleOnce(function(){cc.director.loadScene("Login")},2)}}),cc._RF.pop()},{}],BackgroundScaler:[function(e,t){"use strict";cc._RF.push(t,"85828i1gn9MEoZl2e+F39PS","BackgroundScaler"),cc.Class({extends:cc.Component,properties:{scaleMethod:0},start:function(){var e=cc.find("Canvas").getComponent(cc.Canvas),t=cc.view.getFrameSize(),n=this.scaleMethod;if(1==n)e.fitWidth?this.node.height=this.node.width/t.width*t.height:this.node.width=this.node.height/t.height*t.width;else if(2==n)if(e.fitWidth){var i=this.node.height;this.node.height=this.node.width/t.width*t.height,this.node.width=this.node.height/i*this.node.width}else{var o=this.node.width;this.node.width=this.node.height/t.height*t.width,this.node.height=this.node.width/o*this.node.height}}}),cc._RF.pop()},{}],CreateRole:[function(e,t){"use strict";cc._RF.push(t,"3f4f5UIF8VLDrReUDEcZGgw","CreateRole"),cc.Class({extends:cc.Component,properties:{inputName:cc.EditBox},onRandomBtnClicked:function(){var e=["\u4e0a\u5b98","\u6b27\u9633","\u4e1c\u65b9","\u7aef\u6728","\u72ec\u5b64","\u53f8\u9a6c","\u5357\u5bab","\u590f\u4faf","\u8bf8\u845b","\u7687\u752b","\u957f\u5b59","\u5b87\u6587","\u8f69\u8f95","\u4e1c\u90ed","\u5b50\u8f66","\u4e1c\u9633","\u5b50\u8a00"],t=["\u96c0\u5723","\u8d4c\u4fa0","\u8d4c\u5723","\u7a33\u8d62","\u4e0d\u8f93","\u597d\u8fd0","\u81ea\u6478","\u6709\u94b1","\u571f\u8c6a"],n=Math.floor(Math.random()*(e.length-1)),i=Math.floor(Math.random()*(t.length-1));this.inputName.string=e[n]+t[i]},onLoad:function(){cc.utils.main.setFitScreenMode(),this.onRandomBtnClicked()},onBtnConfirmClicked:function(){var e=this.inputName.string;""!=e?(cc.utils.userInfo.nickname=e,cc.utils.userInfo.travellerMode=!0,cc.utils.http.sendRequest("/guestSignup",{username:cc.utils.userInfo.username,nickname:e},function(e){0===e.errcode&&(cc.utils.userInfo.token=e.token,cc.director.loadScene("RoomChoice"))})):console.log("invalid name.")}}),cc._RF.pop()},{}],1:[function(e,t){var n=e("util/"),i=Array.prototype.slice,o=Object.prototype.hasOwnProperty,s=t.exports=l;function r(e,t){return n.isUndefined(t)?""+t:n.isNumber(t)&&!isFinite(t)?t.toString():n.isFunction(t)||n.isRegExp(t)?t.toString():t}function a(e,t){return n.isString(e)?e.length<t?e:e.slice(0,t):e}function c(e){return a(JSON.stringify(e.actual,r),128)+" "+e.operator+" "+a(JSON.stringify(e.expected,r),128)}function d(e,t,n,i,o){throw new s.AssertionError({message:n,actual:e,expected:t,operator:i,stackStartFunction:o})}function l(e,t){e||d(e,!0,t,"==",s.ok)}function u(e,t){if(e===t)return!0;if(n.isBuffer(e)&&n.isBuffer(t)){if(e.length!=t.length)return!1;for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}return n.isDate(e)&&n.isDate(t)?e.getTime()===t.getTime():n.isRegExp(e)&&n.isRegExp(t)?e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase:n.isObject(e)||n.isObject(t)?f(e,t):e==t}function h(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function f(e,t){if(n.isNullOrUndefined(e)||n.isNullOrUndefined(t))return!1;if(e.prototype!==t.prototype)return!1;if(n.isPrimitive(e)||n.isPrimitive(t))return e===t;var o=h(e),s=h(t);if(o&&!s||!o&&s)return!1;if(o)return u(e=i.call(e),t=i.call(t));var r,a,c=m(e),d=m(t);if(c.length!=d.length)return!1;for(c.sort(),d.sort(),a=c.length-1;a>=0;a--)if(c[a]!=d[a])return!1;for(a=c.length-1;a>=0;a--)if(!u(e[r=c[a]],t[r]))return!1;return!0}function p(e,t){return!(!e||!t)&&("[object RegExp]"==Object.prototype.toString.call(t)?t.test(e):e instanceof t||!0===t.call({},e))}function g(e,t,i,o){var s;n.isString(i)&&(o=i,i=null);try{t()}catch(r){s=r}if(o=(i&&i.name?" ("+i.name+").":".")+(o?" "+o:"."),e&&!s&&d(s,i,"Missing expected exception"+o),!e&&p(s,i)&&d(s,i,"Got unwanted exception"+o),e&&s&&i&&!p(s,i)||!e&&s)throw s}s.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=c(this),this.generatedMessage=!0);var t=e.stackStartFunction||d;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var i=n.stack,o=t.name,s=i.indexOf("\n"+o);if(s>=0){var r=i.indexOf("\n",s+1);i=i.substring(r+1)}this.stack=i}}},n.inherits(s.AssertionError,Error),s.fail=d,s.ok=l,s.equal=function(e,t,n){e!=t&&d(e,t,n,"==",s.equal)},s.notEqual=function(e,t,n){e==t&&d(e,t,n,"!=",s.notEqual)},s.deepEqual=function(e,t,n){u(e,t)||d(e,t,n,"deepEqual",s.deepEqual)},s.notDeepEqual=function(e,t,n){u(e,t)&&d(e,t,n,"notDeepEqual",s.notDeepEqual)},s.strictEqual=function(e,t,n){e!==t&&d(e,t,n,"===",s.strictEqual)},s.notStrictEqual=function(e,t,n){e===t&&d(e,t,n,"!==",s.notStrictEqual)},s.throws=function(e,t,n){g.apply(this,[!0].concat(i.call(arguments)))},s.doesNotThrow=function(e,t){g.apply(this,[!1].concat(i.call(arguments)))},s.ifError=function(e){if(e)throw e};var m=Object.keys||function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t}},{"util/":4}],2:[function(e,t){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],3:[function(e,t){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],4:[function(e,t,n){(function(t,i){var o=/%[sdj%]/g;n.format=function(e){if(!x(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,s=i.length,r=String(e).replace(o,function(e){if("%%"===e)return"%";if(n>=s)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(t){return"[Circular]"}default:return e}}),c=i[n];n<s;c=i[++n])_(c)||!I(c)?r+=" "+c:r+=" "+a(c);return r},n.deprecate=function(e,o){if(b(i.process))return function(){return n.deprecate(e,o).apply(this,arguments)};if(!0===t.noDeprecation)return e;var s=!1;return function(){if(!s){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),s=!0}return e.apply(this,arguments)}};var s,r={};function a(e,t){var i={seen:[],stylize:d};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),y(t)?i.showHidden=t:t&&n._extend(i,t),b(i.showHidden)&&(i.showHidden=!1),b(i.depth)&&(i.depth=2),b(i.colors)&&(i.colors=!1),b(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=c),u(i,e,i.depth)}function c(e,t){var n=a.styles[t];return n?"\x1b["+a.colors[n][0]+"m"+e+"\x1b["+a.colors[n][1]+"m":e}function d(e){return e}function l(e){var t={};return e.forEach(function(e){t[e]=!0}),t}function u(e,t,i){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(i,e);return x(o)||(o=u(e,o,i)),o}var s=h(e,t);if(s)return s;var r=Object.keys(t),a=l(r);if(e.showHidden&&(r=Object.getOwnPropertyNames(t)),N(t)&&(r.indexOf("message")>=0||r.indexOf("description")>=0))return f(t);if(0===r.length){if(k(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if(S(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(N(t))return f(t)}var d,y="",_=!1,C=["{","}"];return v(t)&&(_=!0,C=["[","]"]),k(t)&&(y=" [Function"+(t.name?": "+t.name:"")+"]"),S(t)&&(y=" "+RegExp.prototype.toString.call(t)),w(t)&&(y=" "+Date.prototype.toUTCString.call(t)),N(t)&&(y=" "+f(t)),0!==r.length||_&&0!=t.length?i<0?S(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),d=_?p(e,t,i,a,r):r.map(function(n){return g(e,t,i,a,n,_)}),e.seen.pop(),m(d,y,C)):C[0]+y+C[1]}function h(e,t){if(b(t))return e.stylize("undefined","undefined");if(x(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return C(t)?e.stylize(""+t,"number"):y(t)?e.stylize(""+t,"boolean"):_(t)?e.stylize("null","null"):void 0}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,i,o){for(var s=[],r=0,a=t.length;r<a;++r)H(t,String(r))?s.push(g(e,t,n,i,String(r),!0)):s.push("");return o.forEach(function(o){o.match(/^\d+$/)||s.push(g(e,t,n,i,o,!0))}),s}function g(e,t,n,i,o,s){var r,a,c;if((c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),H(i,o)||(r="["+o+"]"),a||(e.seen.indexOf(c.value)<0?(a=_(n)?u(e,c.value,null):u(e,c.value,n-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),b(r)){if(s&&o.match(/^\d+$/))return a;(r=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),r=e.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),r=e.stylize(r,"string"))}return r+": "+a}function m(e,t,n){return e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function v(e){return Array.isArray(e)}function y(e){return"boolean"==typeof e}function _(e){return null===e}function C(e){return"number"==typeof e}function x(e){return"string"==typeof e}function b(e){return void 0===e}function S(e){return I(e)&&"[object RegExp]"===A(e)}function I(e){return"object"==typeof e&&null!==e}function w(e){return I(e)&&"[object Date]"===A(e)}function N(e){return I(e)&&("[object Error]"===A(e)||e instanceof Error)}function k(e){return"function"==typeof e}function A(e){return Object.prototype.toString.call(e)}function O(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(b(s)&&(s=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!r[e])if(new RegExp("\\b"+e+"\\b","i").test(s)){var i=t.pid;r[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,i,t)}}else r[e]=function(){};return r[e]},n.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=v,n.isBoolean=y,n.isNull=_,n.isNullOrUndefined=function(e){return null==e},n.isNumber=C,n.isString=x,n.isSymbol=function(e){return"symbol"==typeof e},n.isUndefined=b,n.isRegExp=S,n.isObject=I,n.isDate=w,n.isError=N,n.isFunction=k,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},n.isBuffer=e("./support/isBuffer");var R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function G(){var e=new Date,t=[O(e.getHours()),O(e.getMinutes()),O(e.getSeconds())].join(":");return[e.getDate(),R[e.getMonth()],t].join(" ")}function H(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){console.log("%s - %s",G(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!I(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":3,_process:5,inherits:2}],5:[function(e,t){var n,i,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}function c(e){if(i===clearTimeout)return clearTimeout(e);if((i===r||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{return i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{i="function"==typeof clearTimeout?clearTimeout:r}catch(e){i=r}})();var d,l=[],u=!1,h=-1;function f(){u&&d&&(u=!1,d.length?l=d.concat(l):h=-1,l.length&&p())}function p(){if(!u){var e=a(f);u=!0;for(var t=l.length;t;){for(d=l,l=[];++h<t;)d&&d[h].run();h=-1,t=l.length}d=null,u=!1,c(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new g(e,t)),1!==l.length||u||a(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(){return[]},o.binding=function(){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],GameAlgorithm:[function(e,t){"use strict";function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}cc._RF.push(t,"a5ad9/qPZNGNqY82KUYkQ7p","GameAlgorithm");var s={da_peng:3,da_wei:6,da_pao:9,da_ti:12,xiao_wei:3,xiao_pao:6,xiao_peng:1,xiao_ti:9,xiao_sp_chi:3,da_sp_chi:6},r={x1:[["x1","x2","x3"],["x1","x1","d1"],["x1","d1","d1"]],x2:[["x1","x2","x3"],["x2","x3","x4"],["x2","x2","d2"],["x2","d2","d2"],["x2","x7","x10"]],x3:[["x1","x2","x3"],["x2","x3","x4"],["x3","x4","x5"],["x3","x3","d3"],["x3","d3","d3"]],x4:[["x2","x3","x4"],["x3","x4","x5"],["x4","x5","x6"],["x4","x4","d4"],["x4","d4","d4"]],x5:[["x3","x4","x5"],["x4","x5","x6"],["x5","x6","x7"],["x5","x5","d5"],["x5","d5","d5"]],x6:[["x4","x5","x6"],["x5","x6","x7"],["x6","x7","x8"],["x6","x6","d6"],["x6","d6","d6"]],x7:[["x5","x6","x7"],["x6","x7","x8"],["x7","x8","x9"],["x7","x7","d7"],["x7","d7","d7"],["x2","x7","x10"]],x8:[["x6","x7","x8"],["x7","x8","x9"],["x8","x9","x10"],["x8","x8","d8"],["x8","d8","d8"]],x9:[["x7","x8","x9"],["x8","x9","x10"],["x9","x9","d9"],["x9","d9","d9"]],x10:[["x8","x9","x10"],["x10","x10","d10"],["x10","d10","d10"],["x2","x7","x10"]],d1:[["d1","d2","d3"],["d1","d1","x1"],["d1","x1","x1"]],d2:[["d1","d2","d3"],["d2","d3","d4"],["d2","d2","x2"],["d2","x2","x2"],["d2","d7","d10"]],d3:[["d1","d2","d3"],["d2","d3","d4"],["d3","d4","d5"],["d3","d3","x3"],["d3","x3","x3"]],d4:[["d2","d3","d4"],["d3","d4","d5"],["d4","d5","d6"],["d4","d4","x4"],["d4","x4","x4"]],d5:[["d3","d4","d5"],["d4","d5","d6"],["d5","d6","d7"],["d5","d5","x5"],["d5","x5","x5"]],d6:[["d4","d5","d6"],["d5","d6","d7"],["d6","d7","d8"],["d6","d6","x6"],["d6","x6","x6"]],d7:[["d5","d6","d7"],["d6","d7","d8"],["d7","d8","d9"],["d7","d7","x7"],["d7","x7","x7"],["d2","d7","d10"]],d8:[["d6","d7","d8"],["d7","d8","d9"],["d8","d9","d10"],["d8","d8","x8"],["d8","x8","x8"]],d9:[["d7","d8","d9"],["d8","d9","d10"],["d9","d9","x9"],["d9","x9","x9"]],d10:[["d8","d9","d10"],["d10","d10","x10"],["d10","x10","x10"],["d2","d7","d10"]]},a=["x2","x7","x10","d2","d7","d10"];cc.Class({extends:cc.Component,properties:{},addToGroup:function(e,t){var n=new Map(t);e.push(n)},filterEmptyGroup:function(e){for(var t,i=[],o=n(e);!(t=o()).done;){for(var s,r=t.value,a=0,c=n(r.entries());!(s=c()).done;){var d=s.value;d[0],a+=d[1]}a>0&&i.push(r)}return i},groupCards:function(e){for(var t=[],n=new Map(JSON.parse(JSON.stringify(Array.from(e)))),i=1;i<=20;++i){var o="x"+i.toString();i>10&&(o="d"+(i-10).toString());var s=n.get(o);s>=3&&(this.addToGroup(t,[[o,s]]),n.set(o,0))}for(var r=1;r<=10;++r){var a="x"+r.toString(),c="d"+r.toString(),d=n.get(a),l=n.get(c);0===d&&0===l||(2===d&&2===l?(this.addToGroup(t,[[a,d]]),this.addToGroup(t,[[c,l]]),n.set(a,0),n.set(c,0)):d+l>=2&&(this.addToGroup(t,[[a,d],[c,l]]),n.set(a,0),n.set(c,0)))}for(var u=[["x1","x2","x3"],["d1","d2","d3"],["x2","x7","x10"],["d2","d7","d10"]],h=0;h<4;++h){for(var f=!0,p=[],g=0;g<3;++g){if(n.get(u[h][g])<1){f=!1;break}p.push([u[h][g],n.get(u[h][g])])}if(f){this.addToGroup(t,p);for(var m=0;m<3;++m)n.set(u[h][m],0)}}for(var v=[],y=1;y<=20;++y){var _="x"+y.toString();y>10&&(_="d"+(y-10).toString());var C=n.get(_);C>0&&(v.push([_,C]),2===v.length&&(this.addToGroup(t,v),v=[]),n.set(_,0))}return 0!==v.length&&(this.addToGroup(t,v),v=[]),t},generateAllCardSet:function(){for(var e=[],t=0;t<=20;++t){var n="x"+t.toString();t>10&&(n="d"+(t-10).toString());for(var i=0;i<4;++i)e.push(n)}return e},shuffle:function(e){return e.map(function(e){return{value:e,sort:Math.random()}}).sort(function(e,t){return e.sort-t.sort}).map(function(e){return e.value})},dealWhenGameStarts:function(){var e=this.generateAllCardSet();e=this.shuffle(e);for(var t=new Map,n=0;n<=20;++n){var i="x"+n.toString();n>10&&(i="d"+(n-10).toString()),t.set(i,0)}for(var o=0;o<21;++o)t.set(e[o],t.get(e[o])+1);return t},findOneCardToShoot:function(e){for(var t,i=n(e.entries());!(t=i()).done;){var o=t.value,s=o[0],r=o[1];if(r<3&&r>0)return s}},checkValidForShoot:function(e,t){return t.get(e)<3},calculateXi:function(e,t){if(Array.isArray(t)){var n=Array.from(t);return n.sort(),console.log("calculate xi  ",n,t),n.toString()===["d1","d2","d3"].toString()||n.toString()===["d10","d2","d7"].toString()?6:n.toString()===["x1","x2","x3"].toString()||n.toString()===["x10","x2","x7"].toString()?3:0}return"x"===t[0]?s["xiao_"+e]:s["da_"+e]},checkTi:function(e,t){var i=[];t&&3===e.get(t)&&i.push(t);for(var o,s=n(e.entries());!(o=s()).done;){var r=o.value,a=r[0];4===r[1]&&i.push(a)}return i},checkPeng:function(e,t){return 2===t.get(e)},checkWei:function(e,t){if(e)return 2===t.get(e);for(var i,o=[],s=n(t.entries());!(i=s()).done;){var r=i.value,a=r[0];3===r[1]&&o.push(a)}return o},checkPao:function(e,t,i,o){if(3===i.get(e))return{status:!0,caseNumber:1};for(var s,r=0,a=n(o);!(s=a()).done;){var c=s.value;if("wei"===c.type){if(c.cards[2]===e)return{status:!0,caseNumber:2,index:r}}else if("peng"===c.type&&c.cards[2]===e&&!1===t)return{status:!0,caseNumber:3,index:r};r+=1}return{status:!1}},checkChiOnlyOnHandDfs:function(e,t,i,o){if(0!==t.get(e))for(var s,a=n(r[e]);!(s=a()).done;){for(var c,d=s.value,l=!0,u=n(d);!(c=u()).done;){var h=c.value;if(t.get(h)>=3&&h!=e){l=!1;break}}if(l){for(var f,p=n(d);!(f=p()).done;){var g=f.value;t.set(g,t.get(g)-1)}for(var m,v=n(d);!(m=v()).done;){var y=m.value;if(t.get(y)<0){l=!1;for(var _,C=n(d);!(_=C()).done;){var x=_.value;t.set(x,t.get(x)+1)}break}}if(!0===l){var b=Array.from(o);b.push(d),this.checkChiOnlyOnHandDfs(e,t,i,b);for(var S,I=n(d);!(S=I()).done;){var w=S.value;t.set(w,t.get(w)+1)}}}}else i.push(o)},checkChi:function(e,t){if(t.get(e)>=3)return{status:!1};var i=new Map(JSON.parse(JSON.stringify(Array.from(t))));i.set(e,i.get(e)+1);var o=[];if(this.checkChiOnlyOnHandDfs(e,i,o,[]),o.length>0){for(var s,r=n(o);!(s=r()).done;)s.value.sort();for(var a,c=n(o=o.sort().filter(function(e,t,n){return!t||e.toString()!==n[t-1].toString()}));!(a=c()).done;)for(var d,l=n(a.value);!(d=l()).done;)for(var u=d.value,h=0;h<2;++h)u[h]===e&&(u[h]=u[2],u[2]=e)}return{status:o.length>0,chiWays:o}},groupCardsBy3Dfs:function(e,t,i,o){if(t<3){if(0===t){for(var s,a=n(o);!(s=a()).done;){var c=s.value;c.xi=this.calculateXi("chi",c.cards)}i.push(o)}}else for(var d,l=n(e.entries());!(d=l()).done;){var u=d.value,h=u[0];if(0!==u[1])for(var f,p=n(r[h]);!(f=p()).done;){for(var g,m=f.value,v=!0,y=n(m);!(g=y()).done;){var _=g.value;e.set(_,e.get(_)-1)}for(var C,x=n(m);!(C=x()).done;){var b=C.value;if(e.get(b)<0){v=!1;for(var S,I=n(m);!(S=I()).done;){var w=S.value;e.set(w,e.get(w)+1)}break}}if(!0===v){var N=Array.from(o);N.push({type:"chi",cards:m,xi:0}),this.groupCardsBy3Dfs(e,t-3,i,N);for(var k,A=n(m);!(k=A()).done;){var O=k.value;e.set(O,e.get(O)+1)}}}}},calculateFanAndTun:function(e,t){for(var i,o=e.concat(t),s=0,r=n(o);!(i=r()).done;)s+=i.value.xi;if(s<15)return{status:!1};for(var c,d=new Map,l=0,u=0,h=0,f=0,p=0,g=n(o);!(c=g()).done;){var m=c.value;if("chi"===m.type){for(var v,y=n(m.cards);!(v=y()).done;){var _=v.value;a.indexOf(_)>=0&&(l+=1),"d"===_[0]?f+=1:h+=1}u+=1}else{var C=3;if(["ti","pao"].indexOf(m.type)>=0){C=4;var x=m.cards[3].slice(1);x="d"===m.cards[3][0]?"x"+x:"d"+x,d.set(m.cards[3],!0),d.get(x)&&(p+=1)}"d"===m.cards[C-1][0]?f+=C:h+=C,a.indexOf(m.cards[C-1])>=0&&(l+=C)}}var b=0,S=[];return l>=10&&(S.push("\u7ea2\u80e1"),b+=l-10+4),0===l&&(b+=8,S.push("\u9ed1\u80e1")),1===l&&(b+=6,S.push("\u70b9\u80e1")),0===u&&(b+=8,S.push("\u5bf9\u80e1")),f>=18&&(b+=f-18+8,S.push("\u5927\u80e1")),h>=16&&(b+=h-16+8,S.push("\u5c0f\u80e1")),p>0&&(S.push("\u56e2\u80e1"),b+=8*p),b||(b=1),{status:!0,fan:b,tun:parseInt((s-12)/3),xi:s,cardsGroups:o,huInfo:S}},checkHuHelper:function(e,t,i,o){for(var s,r=new Map(JSON.parse(JSON.stringify(Array.from(e)))),a=[],c=n(o);!(s=c()).done;){var d=s.value;a.push({type:d.type,xi:d.xi,cards:d.cards})}var l=this.checkTi(r);t||(t=l.length>0);for(var u,h=n(l);!(u=h()).done;){var f=u.value;a.push({cards:[f,f,f,f],type:"ti",xi:this.calculateXi("ti",f)}),a[a.length-1].xi,r.set(f,0)}for(var p,g=n(this.checkWei(null,r));!(p=g()).done;){var m=p.value;a.push({cards:[m,m,m],type:"wei",xi:this.calculateXi("wei",m)}),a[a.length-1].xi,r.set(m,0)}for(var v,y=0,_=n(r.entries());!(v=_()).done;){var C=v.value;C[0],y+=C[1]}var x=null;if(t)for(var b,S=n(r.entries());!(b=S()).done;){var I=b.value,w=I[0];if(2===I[1]&&(y-2)%3==0){r.set(w,0);var N=[];this.groupCardsBy3Dfs(r,y-2,N,[]);for(var k=0,A=N;k<A.length;k++){var O=A[k],R=this.calculateFanAndTun(a,O);(!x||!0===R.status&&R.fan*R.tun>x.fan*x.tun)&&(x=R)}r.set(w,2)}}else if(y%3==0){var G=[];this.groupCardsBy3Dfs(r,y,G,[]);for(var H=0,M=G;H<M.length;H++){var E=M[H],L=this.calculateFanAndTun(a,E);(!x||!0===L.status&&L.fan*L.tun>x.fan*x.tun)&&(x=L)}}return null===x?{status:!1}:x},checkHu:function(e,t,i){var o=new Map(JSON.parse(JSON.stringify(Array.from(t))));i&&o.set(i,o.get(i)+1);for(var s,r=0,a=n(t.entries());!(s=a()).done;)r+=s.value[1];for(var c,d=0,l=!1,u=n(e);!(c=u()).done;){var h=c.value;d+=h.xi,["pao","ti"].indexOf(h.type)>=0&&(l=!0)}var f=this.checkHuHelper(o,l,d,e);return f&&1===r&&!0===f.status&&(f.huInfo.push("\u800d\u7334"),f.fan+=8),f}}),cc._RF.pop()},{}],GameAudioEffect:[function(e,t){"use strict";function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}cc._RF.push(t,"cb034fhsrJFIIpVvVV3eoul","GameAudioEffect"),cc.Class({extends:cc.Component,properties:{},initAudios:function(){this.audioClipsMap=new Map,cc.resources.loadDir("audios/cd",cc.AudioClip,function(e,t){if(e)console.error(e.message);else for(var i,o=n(t);!(i=o()).done;){var s=i.value;if(console.log("url: "+s.name),"_"===s.name[1])this.audioClipsMap.set(s.name,s);else{var r=parseInt(s.name.slice(1));r>10?this.audioClipsMap.set("d"+(r-10),s):this.audioClipsMap.set("x"+r,s)}}}.bind(this)),cc.resources.loadDir("audios/effect",cc.AudioClip,function(e,t){if(e)console.error(e.message);else for(var i,o=n(t);!(i=o()).done;){var s=i.value;this.audioClipsMap.set(s.name,s)}}.bind(this))},playCardOutEffect:function(e){console.log("playCardOutEffect  ",e,this.audioClipsMap),this.audioClipsMap.has(e)&&cc.audioEngine.play(this.audioClipsMap.get(e),!1,1)},actionsEffect:function(e){this.audioClipsMap.has("v_"+e)&&cc.audioEngine.play(this.audioClipsMap.get("v_"+e),!1,1)},dealCardWhenGameStartEffect:function(){this.audioClipsMap.has("runcard")&&cc.audioEngine.play(this.audioClipsMap.get("runcard"),!1,1)}}),cc._RF.pop()},{}],GameNetworkingManager:[function(e,t){"use strict";cc._RF.push(t,"39f3bFW8iBAa5gHmVNbYj/Y","GameNetworkingManager"),cc.Class({extends:cc.Component,properties:{dataEventHandler:null,roomId:null,maxNumOfGames:0,numOfGames:0,numOfMJ:0,seatIndex:-1,seats:null,turn:-1,button:-1,dingque:-1,chupai:-1,isDingQueing:!1,isHuanSanZhang:!1,gamestate:"",isOver:!1,dissoveData:null},clear:function(){this.dataEventHandler=null,null==this.isOver&&(this.seats=null,this.roomId=null,this.maxNumOfGames=0,this.numOfGames=0)},dispatchEvent:function(e,t){this.dataEventHandler&&this.dataEventHandler.emit(e,t)},initEventHandlers:function(){var e=this;cc.utils.net.addHandler("login_result",function(t){e.dispatchEvent("login_result",t)}),cc.utils.net.addHandler("exit_result",function(t){e.dispatchEvent("exit_result",t)}),cc.utils.net.addHandler("disconnect",function(t){e.dispatchEvent("disconnect",t)}),cc.utils.net.addHandler("new_player_entered_room",function(t){e.dispatchEvent("new_player_entered_room",t)}),cc.utils.net.addHandler("other_player_exit",function(t){e.dispatchEvent("other_player_exit",t)}),cc.utils.net.addHandler("game_start",function(t){console.log("game_start received!!!  ",t),0===t.errcode&&e.dispatchEvent("game_start",t)}),cc.utils.net.addHandler("cardsOnHand_result",function(t){console.log("cardsOnHand_result received!!!  ",t),0===t.errcode&&(t.cardsOnHand=new Map(t.cardsOnHand),e.dispatchEvent("cardsOnHand_result",t))}),cc.utils.net.addHandler("other_player_action",function(t){console.log("other_player_action received!!!  ",t),0===t.errcode&&e.dispatchEvent("other_player_action",t)}),cc.utils.net.addHandler("other_player_hu",function(t){console.log("other_player_hu received!!!  ",t),0===t.errcode&&e.dispatchEvent("other_player_hu",t)}),cc.utils.net.addHandler("need_shoot",function(t){console.log("need_shoot received!!!  ",t),0===t.errcode&&e.dispatchEvent("need_shoot",t)}),cc.utils.net.addHandler("dealed_card",function(t){console.log("dealed_card received!!!  ",t),0===t.errcode&&e.dispatchEvent("dealed_card",t)}),cc.utils.net.addHandler("dealed_card_check_hu",function(t){console.log("dealed_card_check_hu received!!!  ",t),0===t.errcode&&e.dispatchEvent("dealed_card_check_hu",t)}),cc.utils.net.addHandler("other_player_shoot",function(t){console.log("other_player_shoot received!!!  ",t),0===t.errcode&&e.dispatchEvent("other_player_shoot",t)}),cc.utils.net.addHandler("check_dihu",function(t){console.log("check_dihu received!!!  ",t),0===t.errcode&&e.dispatchEvent("check_dihu",t)}),cc.utils.net.addHandler("self_action_result",function(t){console.log("self_action_result received!!!  ",t),0===t.errcode&&e.dispatchEvent("self_action_result",t)}),cc.utils.net.addHandler("discarded_dealed_card",function(t){console.log("discarded_dealed_card received!!!  ",t),0===t.errcode&&e.dispatchEvent("discarded_dealed_card",t)}),cc.utils.net.addHandler("wang_hu",function(t){console.log("wang_hu received!!!  ",t),0===t.errcode&&e.dispatchEvent("wang_hu",t)}),cc.utils.net.addHandler("askGameReady",function(t){console.log("askGameReady received!!!  ",t),0===t.errcode&&e.dispatchEvent("askGameReady",t)}),cc.utils.net.addHandler("timer_passed",function(t){console.log("timer_passed received!!!  ",t),0===t.errcode&&e.dispatchEvent("timer_passed",t)})},connectToGameServer:function(e){this.dissoveData=null,cc.utils.wc.show("\u6b63\u5728\u52a0\u5165\u623f\u95f4"),cc.utils.net.connect(function(){console.log("onConnectOK");var t={token:e.token,room_id:e.room_id,time:e.time,username:e.username};cc.utils.net.send("login",t)},function(){console.log("failed."),cc.utils.wc.hide()})},exitToGameServer:function(){var e={username:cc.utils.userInfo.username,token:cc.utils.userInfo.token,room_id:cc.utils.roomInfo.room_id,time:Date.now()};cc.utils.wc.show("\u6b63\u5728\u9000\u51fa\u623f\u95f4"),cc.utils.net.send("exit",e)},checkIfGameReady:function(){console.log("checkIfGameReady is called!");var e={username:cc.utils.userInfo.username,token:cc.utils.userInfo.token,room_id:cc.utils.roomInfo.room_id};cc.utils.net.send("ifGameReady",e)},askForCardsOnHand:function(){console.log("askForCardsOnHand is called!");var e={username:cc.utils.userInfo.username,token:cc.utils.userInfo.token,time:Date.now()};cc.utils.wc.show("\u6b63\u5728\u5f00\u59cb\u6e38\u620f"),cc.utils.net.send("cardsOnHand",e)},takeHuAction:function(e,t,n){var i={status:e.status,fan:e.fan,xi:e.xi,tun:e.tun,huInfo:e.huInfo,cardsGroups:e.cardsGroups,sessionKey:t,seat_id:n};cc.utils.net.send("hu",i)},takeNormalAction:function(e,t,n,i,o,s){void 0===i&&(i=!1),void 0===o&&(o=null),void 0===s&&(s=0),console.log("takeNormalAction is called!  ",o);var r={username:cc.utils.userInfo.username,token:cc.utils.userInfo.token,seat_id:cc.utils.roomInfo.my_seat_id,opCard:t,cards:n,needsHide:i,sessionKey:o,from_wei_or_peng:s,time:Date.now()};cc.utils.net.send(e,r)},takeGuoAction:function(e,t){console.log("takeGuoAction is called!  ",t);var n={username:cc.utils.userInfo.username,token:cc.utils.userInfo.token,seat_id:cc.utils.roomInfo.my_seat_id,isDoneByUser:e,sessionKey:t,time:Date.now()};cc.utils.net.send("guo",n)},takeChiAction:function(e,t){void 0===t&&(t=null);var n={manyCards:e,sessionKey:t,token:cc.utils.userInfo.token};cc.utils.net.send("chi",n)},shootCard:function(e,t){console.log("shootCard is called!");var n={opCard:t,type:e,time:Date.now()};cc.utils.net.send("shootCard",n)}}),cc._RF.pop()},{}],GameOver:[function(e,t){"use strict";function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}cc._RF.push(t,"a21352nJUhNJromoMJXtJAY","GameOver"),cc.Class({extends:cc.Component,properties:{nicknames:{default:[],type:[cc.Label]},scores:{default:[],type:[cc.Label]},allscores:{default:[],type:[cc.Label]},exitButton:cc.Button,huInfo:cc.Label},onLoad:function(){this.holeCardBg=cc.find("Canvas/GameOver/holeCardsBg"),this.cardsGroups=cc.find("Canvas/GameOver/checkout/cardsGroups"),this.nodes=[]},onEnable:function(){if(cc.utils.roomInfo.huInfo){for(var e,t=n(this.nodes);!(e=t()).done;)e.value.destroy();if(this.nodes=[],this.exitButton.node.active=cc.utils.roomInfo.huInfo.lastGame,"wang_hu"!==cc.utils.roomInfo.huInfo.type){for(var i=0;i<3;++i)this.nicknames[i].string=cc.utils.roomInfo.huInfo.nicknames[i],i===cc.utils.roomInfo.huInfo.op_seat_id?this.scores[i].string="+"+(2*cc.utils.roomInfo.huInfo.loseMark).toString():this.scores[i].string="-"+cc.utils.roomInfo.huInfo.loseMark.toString(),this.allscores[i].string=cc.utils.roomInfo.huInfo.afterScore[i].toString();var o=cc.utils.roomInfo.huInfo.holeCards.length;this.holeCardBg.width=50*o;for(var s=this.holeCardBg.width/2-25,r=0;r<o;++r){var a=cc.instantiate(cc.utils.roomInfo.cardsSmall.get(cc.utils.roomInfo.huInfo.holeCards[r]));a.parent=this.holeCardBg,a.width=48,a.height=48,a.x=s,a.y=0,s-=50,this.nodes.push(a)}this.cardsGroups.width=60*cc.utils.roomInfo.huInfo.cardsGroups.length,s=this.cardsGroups.width/2-30;for(var c=0;c<cc.utils.roomInfo.huInfo.cardsGroups.length;++c){for(var d,l=30,u=n(cc.utils.roomInfo.huInfo.cardsGroups[c].cards);!(d=u()).done;){var h=d.value,f=cc.instantiate(cc.utils.roomInfo.cardsSmall.get(h));f.parent=this.cardsGroups,f.width=48,f.height=48,f.x=s,f.y=l,l+=48,this.nodes.push(f)}s-=60}this.huInfo.string=cc.utils.roomInfo.huInfo.huInfo.join(" ")+" "+cc.utils.roomInfo.huInfo.xi.toString()+"\u80e1\u606f"}else{this.huInfo.string=cc.utils.roomInfo.huInfo.huInfo.join(" ");for(var p=0;p<3;++p)this.nicknames[p].string=cc.utils.roomInfo.huInfo.nicknames[p],this.scores[p].string="0",this.allscores[p].string=cc.utils.roomInfo.huInfo.afterScore[p].toString()}}}}),cc._RF.pop()},{}],HTTPUtil:[function(e,t,n){"use strict";cc._RF.push(t,"be25eLIwqZCT5T8cWUa4Xbr","HTTPUtil"),e("assert").fail;var i="http://43.138.67.153:9001";function o(){n.master_url=i,n.url=i}n.master_url=null,n.url=null,n.token=null,o(),n.sendRequest=function e(t,i,o,s,r,a){void 0===r&&(r=!1),void 0===a&&(a=null);var c=cc.loader.getXMLHttpRequest();c.timeout=5e3,null==i&&(i={}),n.token&&(i.token=n.token),null==s&&(s=n.url);var d=t,l="?";for(var u in i)"?"!=l&&(l+="&"),l+=u+"="+i[u];var h=s+d+encodeURI(l);console.log("RequestURL:"+h),c.open("GET",h,!0),cc.sys.isNative&&c.setRequestHeader("Accept-Encoding","gzip,deflate","text/html;charset=UTF-8");var f=setTimeout(function(){c.hasRetried=!0,c.abort(),console.log("http timeout"),p()},5e3),p=function(){e(t,i,o,s,!0,a)};c.onreadystatechange=function(){if(console.log("onreadystatechange"),clearTimeout(f),4===c.readyState&&c.status>=200&&c.status<300){cc.log("request from ["+c.responseURL+"] data [",t,"]");var e=c.responseText,t=null;try{t=JSON.parse(e)}catch(n){console.log("err:"+n),t={errcode:-10001,errmsg:n}}o&&o(t),o=null}else if(4===c.readyState){if(r)return void(a&&a({errcode:400,errmsg:"Cannot connect with the server!"}));console.log("other readystate == 4, status:"+c.status),setTimeout(function(){p()},5e3)}else console.log("other readystate:"+c.readyState+", status:"+c.status)};try{c.send()}catch(g){p()}return c},n.setURL=function(e){i=e,o()},cc._RF.pop()},{assert:1}],JoinGameInput:[function(e,t){"use strict";cc._RF.push(t,"10a1c8jz95Ju4NnpkOWUfin","JoinGameInput"),cc.Class({extends:cc.Component,properties:{nums:{default:[],type:[cc.Label]},_inputIndex:0},onLoad:function(){},onEnable:function(){this.onResetClicked()},onInputFinished:function(e){var t=this;cc.utils.http.sendRequest("/joinRoom",{username:cc.utils.userInfo.username,token:cc.utils.userInfo.token,room_id:e},function(n){if(0==n.errcode)t.node.active=!1,cc.utils.joinRoom(e);else{var i;i=1===n.errcode?"\u623f\u95f4["+e+"]\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165!":2===n.errcode?"\u623f\u95f4["+e+"]\u5df2\u6ee1!":3===n.errcode?"\u60a8\u5df2\u7ecf\u5728\u522b\u7684\u623f\u95f4!":n.errmsg,cc.utils.alert.show("\u63d0\u793a",i),t.onResetClicked()}}.bind(this))},onInput:function(e){if(!(this._inputIndex>=this.nums.length)&&(this.nums[this._inputIndex].string=e,this._inputIndex+=1,this._inputIndex==this.nums.length)){var t=this.parseRoomID();console.log("ok:"+t),this.onInputFinished(t)}},onN0Clicked:function(){this.onInput(0)},onN1Clicked:function(){this.onInput(1)},onN2Clicked:function(){this.onInput(2)},onN3Clicked:function(){this.onInput(3)},onN4Clicked:function(){this.onInput(4)},onN5Clicked:function(){this.onInput(5)},onN6Clicked:function(){this.onInput(6)},onN7Clicked:function(){this.onInput(7)},onN8Clicked:function(){this.onInput(8)},onN9Clicked:function(){this.onInput(9)},onResetClicked:function(){for(var e=0;e<this.nums.length;++e)this.nums[e].string="";this._inputIndex=0},parseRoomID:function(){for(var e="",t=0;t<this.nums.length;++t)e+=this.nums[t].string;return parseInt(e)}}),cc._RF.pop()},{}],Loading:[function(e,t){"use strict";cc._RF.push(t,"7ee377ItBVP9qB/L0MxRA09","Loading"),cc.Class({extends:cc.Component,properties:{tipLabel:cc.Label},onLoad:function(){this.initFrameworks(),cc.utils.main.setFitScreenMode(),console.log(this.tipLabel.string),cc.utils.http.sendRequest("/isServerOn",{},this.onServerOn.bind(this),null,!1,this.onServerOff.bind(this))},testGameAlgorithm:function(){var e=new Map(Object.entries({x1:1,x2:2,x3:1,x4:2,x5:2,x6:2,x7:1,x8:1,x9:0,x10:1,d1:1,d2:2,d3:1,d4:2,d5:1,d6:0,d7:1,d8:0,d9:0,d10:0}));console.log(cc.utils.gameAlgo.checkChi("x2",e).chiWays)},initFrameworks:function(){cc.utils={},cc.utils.http=e("HTTPUtil"),cc.utils.net=e("Net"),cc.utils.net.ip="43.138.67.153:9001",console.log(window.io,cc.utils.net);var t=e("GameNetworkingManager");cc.utils.gameNetworkingManager=new t,cc.utils.gameNetworkingManager.initEventHandlers(),cc.utils.userInfo={username:"",nickname:"",token:"",currentXi:0,currentScore:0,travellerMode:!1};var n=e("Utils");cc.utils.main=new n;var i=e("GameAlgorithm");cc.utils.gameAlgo=new i;var o=e("GameAudioEffect");cc.utils.gameAudio=new o,cc.utils.gameAudio.initAudios()},onServerOn:function(){this.tipLabel.string="\u6b63\u5728\u9884\u52a0\u8f7d\u6e38\u620f...",cc.director.preloadScene("PaohuZiGame",function(){console.log("MainGame preloaded"),cc.director.loadScene("Login")})},onServerOff:function(e){console.log("server is down!",e),this.tipLabel.string="\u8fde\u63a5\u670d\u52a1\u5668\u5931\u8d25!",setTimeout(function(){cc.game.end()},2e3)}}),cc._RF.pop()},{GameAlgorithm:"GameAlgorithm",GameAudioEffect:"GameAudioEffect",GameNetworkingManager:"GameNetworkingManager",HTTPUtil:"HTTPUtil",Net:"Net",Utils:"Utils"}],Login:[function(e,t){"use strict";cc._RF.push(t,"a982fjVKdJCPLQYUy78iWqV","Login"),cc.Class({extends:cc.Component,properties:{username:cc.EditBox,password:cc.EditBox,status:cc.Label},onLoad:function(){cc.utils.main.setFitScreenMode()},start:function(){},onTravellerLogin:function(){var e=cc.sys.localStorage.getItem("account");null==e&&(e=Date.now(),cc.sys.localStorage.setItem("account",e)),cc.utils.userInfo.username=e.toString(),cc.utils.http.sendRequest("/guestLogin",{username:e},function(e){1===e.errcode?cc.director.loadScene("CreateRole"):0===e.errcode&&(cc.utils.userInfo.token=e.token,cc.utils.userInfo.nickname=e.nickname,cc.director.loadScene("RoomChoice"))})},onUsernameLogin:function(){this.username.string.length<6||this.password.string.length<6?this.status.string="\u5e10\u53f7\u6216\u5bc6\u7801\u592a\u77ed!":this.status.string="\u6b63\u5728\u767b\u5f55..."},onWxLoginClicked:function(){jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","wxLogin","()V"),this.schedule(function(){var e=jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","wxLoginIsSuccess","()Z");if(console.log("is success "+e),e){var t=jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","getWxAutoMessage","()Ljava/lang/String;"),n=JSON.parse(t);console.log("jsonInfo is "+n),console.log("$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$"+t),console.log("autoInfo is "+t),this.unscheduleAllCallbacks()}},.5)}}),cc._RF.pop()},{}],MainGame:[function(e,t){"use strict";function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}cc._RF.push(t,"4d25c3C0IdMhrMamddE4svl","MainGame"),cc.Class({extends:cc.Component,properties:{timeLabel:cc.Label,roomIdLabel:cc.Label,remainNumOfGamesLabel:cc.Label,remainNumofCardLabel:cc.Label,delayMSLabel:cc.Label,delayMSNode:cc.Node},onLoad:function(){cc.utils.wc.show("\u6b63\u5728\u52a0\u8f7d\u6e38\u620f"),cc.utils.main.setFitScreenMode(),this.red=new cc.Color(205,0,0),this.green=new cc.Color(0,205,0),this.yellow=new cc.Color(255,200,0),this.reconnection=cc.find("Canvas/ReConnection"),this.cardOnDrag=cc.find("Canvas/Game/CardOnDrag"),this.shootLine=cc.find("Canvas/Game/LeftBottom/ShootLine"),this.roomIdLabel.string=cc.utils.roomInfo.room_id,this.initSeatView(),this.initEventHandlers(),this.initCardSetView(),this.initActionsView(),this.gameOver=cc.find("Canvas/GameOver"),cc.utils.mainGame=this,this.processLoginData(),cc.utils.wc.hide()},determinePossibleMerge:function(e,t){for(var i,o=0,s=n(this.cardGroupsNodes);!(i=s()).done;){var r=i.value,a=r[0];console.log(r.length,a);var c=a.convertToWorldSpaceAR(cc.v2(0,0));if(r.length<=3&&t>=0&&t<=c.y+a.height/2&&e>=c.x-a.width/2&&e<=c.x+a.width/2)return o;if(0===o&&t>=0&&t<=300&&e<c.x-a.width/2)return-1;if(o===this.cardGroupsNodes.length-1&&t>=0&&t<=300&&e>c.x+a.width/2)return this.cardGroupsNodes.length;o+=1}return-2},initDrag:function(e){e.on(cc.Node.EventType.TOUCH_START,function(t){console.log("cc.Node.EventType.TOUCH_START"),e.interactable=e.getComponent(cc.Button).interactable,e.interactable&&(e.opacity=150,this.shootLine.active=!0,this.cardOnDrag.active=!1,this.cardOnDrag.getComponent(cc.Sprite).spriteFrame=e.getComponent(cc.Sprite).spriteFrame,this.cardOnDrag.x=t.getLocationX()-this.node.width/2,this.cardOnDrag.y=t.getLocationY()-this.node.height/2)}.bind(this)),e.on(cc.Node.EventType.TOUCH_MOVE,function(t){console.log("cc.Node.EventType.TOUCH_MOVE"),e.interactable&&(Math.abs(t.getDeltaX())+Math.abs(t.getDeltaY())<.5||(this.cardOnDrag.active=!0,e.opacity=150,this.cardOnDrag.opacity=255,this.cardOnDrag.scaleX=1,this.cardOnDrag.scaleY=1,this.cardOnDrag.x=t.getLocationX()-this.node.width/2,this.cardOnDrag.y=t.getLocationY()-this.node.height/2))}.bind(this)),e.on(cc.Node.EventType.TOUCH_END,function(t){if(e.interactable)if(console.log("cc.Node.EventType.TOUCH_END  ",t.getLocationX(),t.getLocationY(),this.shootLine.y),this.cardOnDrag.active=!1,this.shootLine.active=!1,e.opacity=255,t.getLocationY()>=320)1===this.currentState&&this.shootCardOnHand(e.name,e);else{var n=this.determinePossibleMerge(t.getLocationX(),t.getLocationY());-2!==n&&this.mergeCards(e,n)}}.bind(this)),e.on(cc.Node.EventType.TOUCH_CANCEL,function(t){if(e.interactable)if(console.log("cc.Node.EventType.TOUCH_CANCEL  ",t.getLocationX(),t.getLocationY(),this.shootLine.y),this.cardOnDrag.active=!1,this.shootLine.active=!1,e.opacity=255,this.determinePossibleMerge(t),t.getLocationY()>=320)1===this.currentState&&this.shootCardOnHand(e.name,e);else{var n=this.determinePossibleMerge(t.getLocationX(),t.getLocationY());-2!==n&&this.mergeCards(e,n)}}.bind(this))},mergeCards:function(e,t){this.cardGroups[e.bucket].set(e.name,this.cardGroups[e.bucket].get(e.name)-1);var n=t;-1===t?(this.cardGroups.splice(0,0,new Map),n=0):t===this.cardGroups.length&&this.cardGroups.push(new Map);var i=0;this.cardGroups[n].has(e.name)&&(i=this.cardGroups[n].get(e.name)),this.cardGroups[n].set(e.name,i+1),this.cardGroups=cc.utils.gameAlgo.filterEmptyGroup(this.cardGroups),this.clearAllCardNodes(),this.renderCardsOnHand(this.cardGroups)},clearAllCardNodes:function(){for(var e,t=n(this.cardGroupsNodes);!(e=t()).done;)for(var i,o=n(e.value);!(i=o()).done;)i.value.destroy()},initCardSetView:function(){this.GameCanvas=cc.find("Canvas/Game"),this.dealCardFrame=cc.find("Canvas/Game/DealCardFrame"),this.shootCardFrame=cc.find("Canvas/Game/ShootCardFrame"),this.baseCardNode=cc.find("Canvas/Game/CardSetEffect/CardBlind"),this.cardSetNode=cc.find("Canvas/Game/CardSetEffect"),this.remainNumofCardNode=cc.find("Canvas/Game/CardSetEffect/remainNumofCardLabel"),this.cardsFull=new Map,this.cardsSmall=new Map;for(var e=1;e<=10;++e)this.cardsFull.set("x"+e.toString(),cc.find("Canvas/Game/CardSetFull/x"+e.toString())),this.cardsFull.set("d"+e.toString(),cc.find("Canvas/Game/CardSetFull/d"+e.toString()));for(var t=1;t<=10;++t)this.cardsSmall.set("x"+t.toString(),cc.find("Canvas/Game/CardSetSmall/x"+t.toString())),this.cardsSmall.set("d"+t.toString(),cc.find("Canvas/Game/CardSetSmall/d"+t.toString()));this.cardsSmall.set("back",cc.find("Canvas/Game/CardSetSmall/back")),this.cardsOnMyHandNode=cc.find("Canvas/Game/CardsOnMyHand"),this.cardFullWidth=65,this.cardSmallWidth=40,this.cardsAlreadyUsedMySelfNode=cc.find("Canvas/Game/CardsAlreadyUsedMySelf"),this.cardsAlreadyUsedPrevNode=cc.find("Canvas/Game/CardsAlreadyUsedPrev"),this.cardsAlreadyUsedNextNode=cc.find("Canvas/Game/CardsAlreadyUsedNext"),this.cardsAlreadyUsedMySelf=[],this.cardsAlreadyUsedPrev=[],this.cardsAlreadyUsedNext=[],this.cardsDiscardedMySelfNode=cc.find("Canvas/Game/CardsDiscardedMySelf"),this.cardsDiscardedPrevNode=cc.find("Canvas/Game/CardsDiscardedPrev"),this.cardsDiscardedNextNode=cc.find("Canvas/Game/CardsDiscardedNext"),this.cardsDiscardedMySelf=[],this.cardsDiscardedPrev=[],this.cardsDiscardedNext=[],this.cardsAlreadyChoseToNotUse=[],cc.utils.roomInfo.cardsSmall=this.cardsSmall},dealHoleCard:function(e,t){console.log("dealHoleCard   ",this.currentOnBoardCardNode),this.currentOnBoardCardNode&&(this.currentOnBoardCardNode.removeAllChildren(!1),this.currentOnBoardCardNode.destroy(),this.currentOnBoardCardNode=null);var n=cc.instantiate(this.cardsFull.get(e));this.dealCardFrame.parent=n,this.dealCardFrame.width=65,this.dealCardFrame.height=194,this.dealCardFrame.x=0,this.dealCardFrame.y=0,this.dealCardFrame.active=!0,this.currentOnBoardCardNode=n,n.interactable=!1,n.parent=this.cardSetNode,n.width=65,n.height=194,n.x=0,n.y=0,n.scaleX=.1,n.scaleY=.1;var i=0,o=0;1===t?o=-100:i=0===t?-130:130,cc.utils.gameAudio.playCardOutEffect(e),cc.tween(n).to(.4,{position:cc.v2(i,o),scale:.8}).start()},shootCardOnHand:function(e,t,n){var i=this;if(void 0===n&&(n=!1),cc.utils.gameAlgo.checkValidForShoot(e,this.cardsOnHand)){console.log("shootcard   ",this.currentOnBoardCardNode),this.cardsAlreadyChoseToNotUse.push(e),this.currentOnBoardCardNode&&(this.currentOnBoardCardNode.removeAllChildren(!1),this.currentOnBoardCardNode.destroy(),this.currentOnBoardCardNode=null),this.shootCardFrame.parent=t,this.shootCardFrame.width=65,this.shootCardFrame.height=194,this.shootCardFrame.x=0,this.shootCardFrame.y=0,this.shootCardFrame.active=!0,this.currentOnBoardCardNode=t,console.log("current cards on hand",this.cardsOnHand);var o=this.cardSetNode.convertToWorldSpaceAR(cc.v2(0,0));cc.utils.gameAudio.playCardOutEffect(e),cc.tween(t).to(.4,{position:cc.v2(0,o.y+-100),scale:.8}).call(function(){t.getComponent(cc.Button).interactable=!1,i.cardsOnHand.set(e,i.cardsOnHand.get(e)-1),i.cardGroups[t.bucket].set(e,i.cardGroups[t.bucket].get(e)-1),i.cardGroups=cc.utils.gameAlgo.filterEmptyGroup(i.cardGroups),i.cardGroupsNodes[t.bucket].splice(t.innerIndex,1),i.clearAllCardNodes(),i.renderCardsOnHand(i.cardGroups),console.log("after cards on hand",i.cardsOnHand)}).start(),n||cc.utils.gameNetworkingManager.shootCard("onHand",e),this.hiderTimer(cc.utils.roomInfo.my_seat_id),this.currentState=0}},shootCardOthers:function(e,t,n){void 0===n&&(n=!0),console.log("shootCardOthers  ",this.currentOnBoardCardNode),this.currentOnBoardCardNode&&(this.currentOnBoardCardNode.removeAllChildren(!1),this.currentOnBoardCardNode.destroy(),this.currentOnBoardCardNode=null);var i=-130,o=cc.instantiate(this.cardsFull.get(e));o.interactable=!1,o.parent=this.seats[t].self,o.width=65,o.height=194,o.x=100,o.y=0,o.scaleX=.1,o.scaleY=.1,o.active=!0,this.currentOnBoardCardNode=o,this.shootCardFrame.parent=o,this.shootCardFrame.width=65,this.shootCardFrame.height=194,this.shootCardFrame.x=0,this.shootCardFrame.y=0,this.shootCardFrame.active=!0,n||(i=130);var s=this.cardSetNode.convertToWorldSpaceAR(cc.v2(0,0)),r=this.seats[t].self.convertToNodeSpaceAR(cc.v2(s.x+i,s.y));cc.utils.gameAudio.playCardOutEffect(e),cc.tween(o).to(.4,{position:r,scale:.8}).start()},initActionsView:function(){this.actionsNode=cc.find("Canvas/Game/Actions"),this.buttonsNode=new Map,this.buttonsNode.set("peng",cc.find("Canvas/Game/Actions/peng")),this.buttonsNode.set("chi",cc.find("Canvas/Game/Actions/chi")),this.buttonsNode.set("guo",cc.find("Canvas/Game/Actions/guo")),this.buttonsNode.set("hu",cc.find("Canvas/Game/Actions/hu")),this.buttonsNode.set("chiWaysBox",cc.find("Canvas/Game/Actions/chiWaysBox"))},renderActionsList:function(e){this.actionsNode.active=!0;for(var t=-80,n=e.length-1;n>=0;--n)this.buttonsNode.get(e[n]).x=t,this.buttonsNode.get(e[n]).active=!0,t-=130},renderCardsOnHand:function(e){this.cardGroups=e,this.cardGroupsNodes=[];for(var t=0-Math.min(parseInt(e.length/2),4)*this.cardFullWidth,i=1;i<=e.length;++i){for(var o,s=[],r=n(e[i-1].entries());!(o=r()).done;)for(var a=o.value,c=a[0],d=a[1],l=0;l<d;++l)s.push(cc.instantiate(this.cardsFull.get(c))),s[s.length-1].parent=this.cardsOnMyHandNode,s[s.length-1].width=65,s[s.length-1].height=194;for(var u=115,h=s.length-1;h>=0;h-=1)s[h].setPosition(t,u),s[h].active=!0,u+=60,s[h].bucket=i-1,s[h].innerIndex=h;this.cardGroupsNodes.push(s),t+=this.cardFullWidth}for(var f,p=n(this.cardGroupsNodes);!(f=p()).done;)for(var g,m=n(f.value);!(g=m()).done;){var v=g.value;this.initDrag(v)}},addDiscardedCard:function(e,t,i,o){void 0===o&&(o=!1);for(var s,r=[],a=[],c=n(e);!(s=c()).done;){var d=s.value;r.push(d.name)}var l=null,u=30+e.length*this.cardSmallWidth;!0===o&&(u=-30-e.length*this.cardSmallWidth),(l=cc.instantiate(this.cardsSmall.get(i))).parent=t,l.x=u,l.y=0,l.active=!0,e.push(l);for(var h,f=n(e);!(h=f()).done;){var p=h.value;a.push(p.name)}console.log("addDiscardedCard result  ",r,a)},addUsedCards:function(e,t,i,o,s,r,a,c){if(void 0===r&&(r=!1),void 0===a&&(a=0),void 0===c&&(c=!1),console.log("addusedcard before  ",e,a),a)for(var d,l=n(e);!(d=l()).done;){var u=d.value;if(["wei","peng"].indexOf(u.type)>=0&&u.cards[2]==i[i.length-1]){if("pao"===o&&"wei"===u.type)for(var h=0;h<3;++h)u.cards[h]=i[i.length-1],u.nodes[h].getComponent(cc.Sprite).spriteFrame=this.cardsSmall.get(i[i.length-1]).getComponent(cc.Sprite).spriteFrame;u.cards.push(i[i.length-1]),u.nodes.push(cc.instantiate(this.cardsSmall.get(i[i.length-1]))),u.nodes[u.nodes.length-1].parent=t,u.nodes[u.nodes.length-1].x=u.nodes[u.nodes.length-2].x,u.nodes[u.nodes.length-1].y=u.nodes[u.nodes.length-2].y+this.cardSmallWidth,u.nodes[u.nodes.length-1].active=!0,u.type=o,u.xi=s}}else{var f=[],p=30+e.length*this.cardSmallWidth,g=0;!0===r&&(p=-30-e.length*this.cardSmallWidth);for(var m,v=n(i);!(m=v()).done;){var y=m.value;"ti"===o&&c||"wei"===o&&e!==this.cardsAlreadyUsedMySelf?f.push(cc.instantiate(this.cardsSmall.get("back"))):f.push(cc.instantiate(this.cardsSmall.get(y))),f[f.length-1].parent=t,f[f.length-1].x=p,f[f.length-1].y=g,f[f.length-1].active=!0,g+=this.cardSmallWidth}e.push({cards:i,nodes:f,type:o,xi:s})}console.log("addusedcard after  ",e,a)},setSeatInfo:function(e,t,n,i,o,s,r){void 0===n&&(n=""),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=!0),void 0===r&&(r=!0),t?(this.seats[e].icon.spriteFrame=this.seatNobodyIcon,this.seats[e].ready.active=!1,this.seats[e].offline.active=!1):(this.seats[e].icon.spriteFrame=this.seatIcon,this.seats[e].ready.active=r,this.seats[e].offline.active=!s),this.seats[e].name.string=n,this.seats[e].xi.string=i.toString(),this.seats[e].score.string=o.toString()},initSeatView:function(){this.exitButton=cc.find("Canvas/Players/exitButton"),this.seats=[];for(var e=1;e<4;++e)this.seats.push({icon:cc.find("Canvas/Players/seat"+e.toString()+"/PlayerIcon").getComponent(cc.Sprite),offline:cc.find("Canvas/Players/seat"+e.toString()+"/offline"),name:cc.find("Canvas/Players/seat"+e.toString()+"/nameLabel").getComponent(cc.Label),score:cc.find("Canvas/Players/seat"+e.toString()+"/scoreLabel").getComponent(cc.Label),xi:cc.find("Canvas/Players/seat"+e.toString()+"/xi/xiLabel").getComponent(cc.Label),ready:cc.find("Canvas/Players/seat"+e.toString()+"/ready"),self:cc.find("Canvas/Players/seat"+e.toString()),peng:cc.find("Canvas/Players/seat"+e.toString()+"/peng"),chi:cc.find("Canvas/Players/seat"+e.toString()+"/chi"),ti:cc.find("Canvas/Players/seat"+e.toString()+"/ti"),wei:cc.find("Canvas/Players/seat"+e.toString()+"/wei"),hu:cc.find("Canvas/Players/seat"+e.toString()+"/hu"),pao:cc.find("Canvas/Players/seat"+e.toString()+"/pao"),timerBg:cc.find("Canvas/Players/seat"+e.toString()+"/timerBg"),timerLabel:cc.find("Canvas/Players/seat"+e.toString()+"/timerLabel")});this.seats[1].timerBg=cc.find("Canvas/Game/CardsOnMyHand/timerBg"),this.seats[1].timerLabel=cc.find("Canvas/Game/CardsOnMyHand/timerLabel"),this.seatNobodyIcon=this.seats[1].icon.spriteFrame,this.seatNobodyIcon.width=74,this.seatNobodyIcon.height=74,this.seatIcon=this.seats[0].icon.spriteFrame,this.setSeatInfo(1,!1,cc.utils.userInfo.nickname,0,0,!0),this.nextPlayerId=cc.utils.roomInfo.my_seat_id+1,this.nextPlayerId>=3&&(this.nextPlayerId=0),this.prevPlayerId=cc.utils.roomInfo.my_seat_id-1,this.prevPlayerId<0&&(this.prevPlayerId=2),this.setSeatInfo(2,!0),this.setSeatInfo(0,!0)},initEventHandlers:function(){cc.utils.gameNetworkingManager.dataEventHandler=this.node,this.node.on("exit_result",function(e){console.log("exit_result arrived"),0===e.errcode?(cc.utils.net.close(),cc.utils.roomInfo=null,cc.director.loadScene("RoomChoice")):cc.utils.wc.hide()}),this.node.on("disconnect",function(){!0!==cc.utils.roomInfo.exited&&(console.log("disconnect arrived"),this.reconnection.active=!0)}.bind(this)),this.node.on("new_player_entered_room",function(e){var t=e.seat_id===this.nextPlayerId?2:0;!0===e.relogin?this.seats[t].offline.active=!1:this.setSeatInfo(t,!1,e.nickname,0,e.score,e.online)}.bind(this)),this.node.on("other_player_exit",function(e){console.log("other_player_exit",e);var t=e.seat_id===this.nextPlayerId?2:0;!0===e.completely_left?this.setSeatInfo(t,!0):this.seats[t].offline.active=!0}.bind(this)),this.node.on("game_start",function(e){this.resetEverything(),this.renderHoleCards(),this.gameOver.active=!1,console.log("game_start",e),this.exitButton.active=!1,cc.utils.roomInfo.number_of_wang=e.number_of_wang,cc.utils.roomInfo.current_played_games=e.current_played_games,this.remainNumOfGamesLabel.string=(e.total_games-e.current_played_games).toString(),cc.utils.roomInfo.total_games=e.total_games,this.remainNumofCardNode.active=!0,this.remainNumofCardLabel.string="19";for(var t=0;t<3;++t)this.seats[t].ready.active=!1;this.cardsOnHand=new Map(e.cardsOnHand);var i=cc.utils.gameAlgo.groupCards(this.cardsOnHand);this.renderCardsOnHand(i);var o=cc.utils.gameAlgo.checkTi(this.cardsOnHand);if(o.length>0){cc.utils.gameAudio.actionsEffect("ti");for(var s,r=n(o);!(s=r()).done;){var a=s.value;this.takeNormalAction("ti",a,["back","back","back",a],!0)}}cc.utils.gameAudio.dealCardWhenGameStartEffect(),this.sessionKey=e.sessionKey;var c=e.card21st,d="\u5730\u80e1";0===cc.utils.roomInfo.my_seat_id&&(c=null,d="\u5929\u80e1");var l=cc.utils.gameAlgo.checkHu(this.cardsAlreadyUsedMySelf,this.cardsOnHand,c);l&&!0===l.status?(l.huInfo.push(d),l.fan+=4,cc.utils.roomInfo.number_of_wang>0&&(l.huInfo.push("\u738b"+cc.utils.roomInfo.number_of_wang.toString()),l.fan+=4*cc.utils.roomInfo.number_of_wang),cc.utils.roomInfo.huResult=l,this.showTimer(cc.utils.roomInfo.my_seat_id),this.renderActionsList(["hu","guo"])):cc.utils.gameNetworkingManager.takeGuoAction(!1,e.sessionKey)}.bind(this)),this.node.on("dealed_card_check_hu",function(e){this.currentDealShootInfo={type:1,op_seat_id:e.op_seat_id,opCard:e.dealed_card},this.remainNumofCardLabel.string=parseInt(this.remainNumofCardLabel.string)-1,++this.backCardsCulm,(8===this.backCardsLast&&3===this.backCards||2===this.backCardsCulm)&&(this.backCards[this.backCardsLast].active=!1,this.backCardsLast--,this.backCardsCulm=0);var t=e.op_seat_id===this.nextPlayerId?2:0;e.op_seat_id===cc.utils.roomInfo.my_seat_id&&(t=1),this.sessionKey=e.sessionKey,this.dealHoleCard(e.dealed_card,t),this.showHideTiCard(t),cc.utils.roomInfo.currentCard=null;var n=this.calculateAvailableActions(e.dealed_card,!1,e.op_seat_id,!0);n.length>0?(this.showTimer(cc.utils.roomInfo.my_seat_id),this.renderActionsList(n)):(cc.utils.gameNetworkingManager.takeGuoAction(!1,this.sessionKey),this.sessionKey=null)}.bind(this)),this.node.on("dealed_card",function(e){this.currentDealShootInfo={type:1,op_seat_id:e.op_seat_id,opCard:e.dealed_card},!1===e.hasPrevCheckHu&&(this.remainNumofCardLabel.string=parseInt(this.remainNumofCardLabel.string)-1,++this.backCardsCulm,(8===this.backCardsLast&&3===this.backCards||2===this.backCardsCulm)&&(this.backCards[this.backCardsLast].active=!1,this.backCardsLast--,this.backCardsCulm=0));var t=e.op_seat_id===this.nextPlayerId?2:0;if(e.op_seat_id===cc.utils.roomInfo.my_seat_id&&(t=1),this.sessionKey=e.sessionKey,cc.utils.roomInfo.currentCard=e.dealed_card,console.log("dealed_card  ",t),this.showHideTiCard(t),!0===e.ti_wei_pao_result.status)if("wei"===e.ti_wei_pao_result.type&&e.op_seat_id!==cc.utils.roomInfo.my_seat_id||!1===e.hasPrevCheckHu&&this.dealHoleCard(e.dealed_card,t),cc.utils.gameAudio.actionsEffect(e.ti_wei_pao_result.type),e.ti_wei_pao_result.op_seat_id===cc.utils.roomInfo.my_seat_id)this.takeNormalAction(e.ti_wei_pao_result.type,e.ti_wei_pao_result.opCard,e.ti_wei_pao_result.cards,!1,!1,e.ti_wei_pao_result.from_wei_or_peng);else{t=e.ti_wei_pao_result.op_seat_id===this.nextPlayerId?2:0;var n=this.cardsAlreadyUsedPrev,i=this.cardsAlreadyUsedPrevNode,o=!1;e.ti_wei_pao_result.op_seat_id===this.nextPlayerId&&(n=this.cardsAlreadyUsedNext,i=this.cardsAlreadyUsedNextNode,o=!0),this.seats[t].xi.string=e.xi.toString(),this.seats[t][e.ti_wei_pao_result.type].active=!0,this.scheduleOnce(function(){this.seats[t][e.ti_wei_pao_result.type].active=!1}.bind(this),1),this.addUsedCards(n,i,e.ti_wei_pao_result.cards,e.ti_wei_pao_result.type,0,o,e.ti_wei_pao_result.from_wei_or_peng,!1)}else{!1===e.hasPrevCheckHu&&this.dealHoleCard(e.dealed_card,t);var s=this.calculateAvailableActions(e.dealed_card,!1,e.op_seat_id);s.length>0?(this.showTimer(cc.utils.roomInfo.my_seat_id),this.renderActionsList(s)):(cc.utils.gameNetworkingManager.takeGuoAction(!1,this.sessionKey),this.sessionKey=null)}}.bind(this)),this.node.on("other_player_hu",function(e){var t=e.op_seat_id===this.nextPlayerId?2:0;cc.utils.gameAudio.actionsEffect("hu"),this.seats[t].hu.active=!0,cc.utils.roomInfo.huInfo=e,this.scheduleOnce(function(){this.seats[t].hu.active=!1}.bind(this),1);for(var n=0;n<3;++n){var i=1;n===this.nextPlayerId?i=2:n===this.prevPlayerId&&(i=0),this.seats[i].score.string=cc.utils.roomInfo.huInfo.afterScore[n].toString()}this.scheduleOnce(function(){this.gameOver.active=!0}.bind(this),2)}.bind(this)),this.node.on("wang_hu",function(e){cc.utils.roomInfo.huInfo=e,this.scheduleOnce(function(){this.gameOver.active=!0}.bind(this),1)}.bind(this)),this.node.on("self_action_result",function(e){if("hu"===e.type)this.takeHuAction(e);else if("peng"===e.type)cc.utils.gameAudio.actionsEffect("peng"),this.takeNormalAction("peng",e.cards[0],e.cards,!1,!1);else if("chi"===e.type){cc.utils.gameAudio.actionsEffect("chi"),this.cardGroups[0].has(e.opCard)?this.cardGroups[0].set(e.opCard,this.cardGroups[0].get(e.opCard)+1):this.cardGroups[0].set(e.opCard,1),this.cardsOnHand.set(e.opCard,this.cardsOnHand.get(e.opCard)+1);for(var t,i=n(e.manyCards);!(t=i()).done;){var o=t.value;this.takeNormalAction("chi",e.opCard,o,!1,!1)}}}.bind(this)),this.node.on("other_player_action",function(e){cc.utils.gameAudio.actionsEffect(e.type),console.log(this.nextPlayerId,this.prevPlayerId);var t=this.cardsAlreadyUsedPrev,i=this.cardsAlreadyUsedPrevNode,o=!1,s=0;if(e.op_seat_id===this.nextPlayerId&&(t=this.cardsAlreadyUsedNext,i=this.cardsAlreadyUsedNextNode,o=!0,s=2),this.seats[s][e.type].active=!0,this.scheduleOnce(function(){this.seats[s][e.type].active=!1}.bind(this),1),this.seats[s].xi.string=e.xi.toString(),"chi"===e.type)for(var r,a=n(e.manyCards);!(r=a()).done;){var c=r.value;this.addUsedCards(t,i,c,e.type,0,o,0)}else{var d=!1;"ti"===e.type&&(d=e.needsHide),this.addUsedCards(t,i,e.cards,e.type,0,o,e.from_wei_or_peng,d)}}.bind(this)),this.node.on("need_shoot",function(e){if(e.op_seat_id===cc.utils.roomInfo.my_seat_id)if(this.currentDealShootInfo&&1===this.currentDealShootInfo.type){console.log("checkHu  in need_shoot  ",this.cardsAlreadyUsedMySelf,this.cardsOnHand);var t=cc.utils.gameAlgo.checkHu(this.cardsAlreadyUsedMySelf,this.cardsOnHand),n=[];t&&!0===t.status&&(n.push("hu"),this.currentDealShootInfo.op_seat_id===cc.utils.roomInfo.my_seat_id&&(t.huInfo.push("\u81ea\u6478"),t.tun+=1),cc.utils.roomInfo.number_of_wang>0&&(t.huInfo.push("\u738b"+cc.utils.roomInfo.number_of_wang.toString()),t.fan+=4*cc.utils.roomInfo.number_of_wang),cc.utils.roomInfo.huResult=t),n.length>0?(n.push("guo"),this.renderActionsList(n),this.currentState=3):this.currentState=1}else this.currentState=1;this.showTimer(e.op_seat_id)}.bind(this)),this.node.on("other_player_shoot",function(e){this.currentDealShootInfo={type:0,op_seat_id:e.op_seat_id},this.sessionKey=e.sessionKey;var t=e.op_seat_id===this.prevPlayerId,n=e.op_seat_id===this.nextPlayerId?2:0;if(this.shootCardOthers(e.opCard,n,t),this.showHideTiCard(n),this.seats[n].timerBg.active=!1,this.seats[n].timerLabel.active=!1,e.paoResult)if(e.paoResult.op_seat_id===cc.utils.roomInfo.my_seat_id)cc.utils.gameAudio.actionsEffect("pao"),this.takeNormalAction("pao",e.opCard,[e.opCard,e.opCard,e.opCard,e.opCard],!1,!1,e.paoResult.from_wei);else{var i=this.cardsAlreadyUsedPrev,o=this.cardsAlreadyUsedPrevNode,s=!1,r=0;e.paoResult.op_seat_id===this.nextPlayerId&&(i=this.cardsAlreadyUsedNext,o=this.cardsAlreadyUsedNextNode,s=!0,r=2),this.seats[r].xi.string=e.paoResult.xi.toString(),this.seats[r].pao.active=!0,this.scheduleOnce(function(){this.seats[r].pao.active=!1}.bind(this),1),this.addUsedCards(i,o,e.paoResult.cards,e.paoResult.type,0,s,e.paoResult.from_wei,!1)}else{cc.utils.roomInfo.currentCard=e.opCard;var a=this.calculateAvailableActions(e.opCard,!0,e.op_seat_id,!0);a.length>0?(this.showTimer(cc.utils.roomInfo.my_seat_id),this.renderActionsList(a)):cc.utils.gameNetworkingManager.takeGuoAction(!1,this.sessionKey)}}.bind(this)),this.node.on("discarded_dealed_card",function(e){var t=this,n=e.op_seat_id===this.nextPlayerId?2:0;e.op_seat_id===cc.utils.roomInfo.my_seat_id&&(n=1);var i=!1,o=this.cardsDiscardedPrev,s=this.cardsDiscardedPrevNode;if(2===n?(o=this.cardsDiscardedNext,s=this.cardsDiscardedNextNode,i=!0):1===n&&(o=this.cardsDiscardedMySelf,s=this.cardsDiscardedMySelfNode,i=!0),this.addDiscardedCard(o,s,e.opCard,i),this.currentOnBoardCardNode){var r=o[o.length-1].convertToWorldSpaceAR(cc.v2(o[o.length-1].x,o[o.length-1].y)),a=this.currentOnBoardCardNode.convertToNodeSpaceAR(r);cc.tween(this.currentOnBoardCardNode).to(.4,{position:a}).call(function(){t.currentOnBoardCardNode.removeAllChildren(!1),t.currentOnBoardCardNode.destroy(),t.currentOnBoardCardNode=null}).start()}}.bind(this)),this.node.on("askGameReady",function(){cc.utils.gameNetworkingManager.checkIfGameReady()}.bind(this)),this.node.on("timer_passed",function(e){if("shoot_card"===e.type){for(var t,i=n(this.cardGroupsNodes);!(t=i()).done;)for(var o,s=n(t.value);!(o=s()).done;){var r=o.value;if(r.name===e.opCard){this.shootCardOnHand(e.opCard,r,!0);break}}this.hideActionList()}else"operation"===e.type&&(cc.utils.roomInfo.currentCard&&this.cardsAlreadyChoseToNotUse.push(cc.utils.roomInfo.currentCard),this.hideActionList(),this.hiderTimer(cc.utils.roomInfo.my_seat_id),this.clearActionResult())}.bind(this))},calculateAvailableActions:function(e,t,n,i){void 0===i&&(i=!1),console.log("current cardsonhand  ",this.cardGroups,this.cardsAlreadyChoseToNotUse);var o=[];if(!i){if((n===this.prevPlayerId||n===cc.utils.roomInfo.my_seat_id)&&this.cardsAlreadyChoseToNotUse.indexOf(e)<0){var s=cc.utils.gameAlgo.checkChi(e,this.cardsOnHand);s&&!0===s.status&&(o.push("chi"),cc.utils.roomInfo.chiResult=s)}cc.utils.gameAlgo.checkPeng(e,this.cardsOnHand)&&this.cardsAlreadyChoseToNotUse.indexOf(e)<0&&(o.push("peng"),cc.utils.roomInfo.pengResult={status:!0,opCard:e})}if(!1===t&&i){var r=cc.utils.gameAlgo.checkHu(this.cardsAlreadyUsedMySelf,this.cardsOnHand,e);r&&!0===r.status&&(o.push("hu"),n===cc.utils.roomInfo.my_seat_id&&(r.huInfo.push("\u81ea\u6478"),r.tun+=1),cc.utils.roomInfo.number_of_wang>0&&(r.huInfo.push("\u738b"+cc.utils.roomInfo.number_of_wang.toString()),r.fan+=4*cc.utils.roomInfo.number_of_wang),cc.utils.roomInfo.huResult=r)}return o.length>0&&o.push("guo"),o},hideActionList:function(){cc.utils.roomInfo.chiWaysNode&&(cc.utils.roomInfo.chiWaysNode.destroy(),cc.utils.roomInfo.chiWaysNode=null);for(var e,t=n(this.buttonsNode.entries());!(e=t()).done;){var i=e.value;i[0],i[1].active=!1}this.actionsNode.active=!1},clearActionResult:function(){cc.utils.roomInfo.pengResult=null,cc.utils.roomInfo.huResult=null,cc.utils.roomInfo.chiResult=null,cc.utils.roomInfo.currentCard=null},takeHuAction:function(e){this.hideActionList(),cc.utils.gameAudio.actionsEffect("hu"),this.seats[1].hu.active=!0,this.scheduleOnce(function(){this.seats[1].hu.active=!1}.bind(this),1),cc.utils.roomInfo.huInfo=e;for(var t=0;t<3;++t){var n=1;t===this.nextPlayerId?n=2:t===this.prevPlayerId&&(n=0),this.seats[n].score.string=cc.utils.roomInfo.huInfo.afterScore[t].toString()}this.scheduleOnce(function(){this.gameOver.active=!0}.bind(this),2)},takeNormalAction:function(e,t,i,o,s,r,a){void 0===o&&(o=!1),void 0===s&&(s=!0),void 0===r&&(r=0),void 0===a&&(a=null),this.seats[1][e].active=!0,this.scheduleOnce(function(){this.seats[1][e].active=!1}.bind(this),1);var c=0;if("chi"===e){c=cc.utils.gameAlgo.calculateXi(e,i);for(var d,l=n(i);!(d=l()).done;){for(var u=d.value,h=0;h<this.cardGroups.length;++h)this.cardGroups[h].get(u)>0&&this.cardGroups[h].set(u,this.cardGroups[h].get(u)-1);this.cardsOnHand.get(u)>0&&this.cardsOnHand.set(u,this.cardsOnHand.get(u)-1)}}else{c=cc.utils.gameAlgo.calculateXi(e,t),this.cardsOnHand.set(t,0);for(var f=0;f<this.cardGroups.length;++f)this.cardGroups[f].get(t)>0&&this.cardGroups[f].set(t,0)}if(r)for(var p,g=n(this.cardsAlreadyUsedMySelf);!(p=g()).done;){var m=p.value;["wei","peng"].indexOf(m.type)>=0&&m.cards[2]==i[i.length-1]&&(cc.utils.userInfo.currentXi-=m.xi)}cc.utils.userInfo.currentXi+=c,this.seats[1].xi.string=cc.utils.userInfo.currentXi.toString(),this.cardGroups=cc.utils.gameAlgo.filterEmptyGroup(this.cardGroups),this.clearAllCardNodes(),this.renderCardsOnHand(this.cardGroups),this.addUsedCards(this.cardsAlreadyUsedMySelf,this.cardsAlreadyUsedMySelfNode,i,e,c,!1,r),s&&cc.utils.gameNetworkingManager.takeNormalAction(e,t,i,o,a,r)},onReturnToLobbyClicked:function(){cc.utils.roomInfo.exited=!0,cc.utils.gameNetworkingManager.exitToGameServer()},hiderTimer:function(e){var t=this.seats[1].timerBg,n=this.seats[1].timerLabel;e===this.prevPlayerId?(t=this.seats[0].timerBg,n=this.seats[0].timerLabel):e===this.nextPlayerId&&(t=this.seats[2].timerBg,n=this.seats[2].timerLabel),t.active=!1,n.active=!1},showTimer:function(e,t){void 0===t&&(t=30),this.timerCallback&&(this.unschedule(this.timerCallback),this.timerCallback=null);var n=this.seats[1].timerBg,i=this.seats[1].timerLabel;e===this.prevPlayerId?(n=this.seats[0].timerBg,i=this.seats[0].timerLabel):e===this.nextPlayerId&&(n=this.seats[2].timerBg,i=this.seats[2].timerLabel),n.active=!0,i.active=!0;var o=i.getComponent(cc.Label);o.string=t.toString();var s=t;this.timerCallback=function(){s-=1,o.string=s.toString(),0===s?(n.active=!1,i.active=!1):n.active||(this.unschedule(this.timerCallback),this.timerCallback=null)},this.schedule(this.timerCallback,1,t-1,1)},update:function(){var e=Math.floor(Date.now()/1e3/60);if(this._lastMinute!=e){this._lastMinute=e;var t=new Date,n=t.getHours();n=n<10?"0"+n:n;var i=t.getMinutes();i=i<10?"0"+i:i,this.timeLabel.string=n+":"+i}null!=cc.utils.net.delayMS?(this.delayMSLabel.string=cc.utils.net.delayMS+"ms",cc.utils.net.delayMS>800?this.delayMSNode.color=this.red:cc.utils.net.delayMS>300?this.delayMSNode.color=this.yellow:this.delayMSNode.color=this.green):(this.delayMSLabel.string="N/A",this.delayMSNode.color=this.red)},onHuClicked:function(){cc.utils.gameNetworkingManager.takeHuAction(cc.utils.roomInfo.huResult,this.sessionKey,cc.utils.roomInfo.my_seat_id),this.hideActionList(),this.hiderTimer(cc.utils.roomInfo.my_seat_id),this.clearActionResult()},onGuoClicked:function(){cc.utils.gameNetworkingManager.takeGuoAction(!0,this.sessionKey),3!==this.currentState?(cc.utils.roomInfo.currentCard&&(this.cardsAlreadyChoseToNotUse.push(cc.utils.roomInfo.currentCard),cc.utils.roomInfo.currentCard=null),this.hideActionList(),this.hiderTimer(cc.utils.roomInfo.my_seat_id),this.clearActionResult()):this.currentState=1},onPengClicked:function(){if(cc.utils.roomInfo.pengResult&&!1!==cc.utils.roomInfo.pengResult.status){var e=[cc.utils.roomInfo.pengResult.opCard,cc.utils.roomInfo.pengResult.opCard,cc.utils.roomInfo.pengResult.opCard];cc.utils.gameNetworkingManager.takeNormalAction("peng",cc.utils.roomInfo.pengResult.opCard,e,!1,this.sessionKey),this.hideActionList(),this.hiderTimer(cc.utils.roomInfo.my_seat_id),this.sessionKey=null,this.clearActionResult()}},onChiClicked:function(){var e=this;if(cc.utils.roomInfo.chiResult&&!1!==cc.utils.roomInfo.chiResult.status){var t=0;cc.utils.roomInfo.chiWaysNode=new cc.Node("Sprite"),cc.utils.roomInfo.chiWaysNode.parent=this.actionsNode,cc.utils.roomInfo.chiWaysNode.x=0,cc.utils.roomInfo.chiWaysNode.y=0;for(var i,o=n(cc.utils.roomInfo.chiResult.chiWays);!(i=o()).done;){var s=i.value,r=cc.instantiate(this.buttonsNode.get("chiWaysBox"));r.parent=cc.utils.roomInfo.chiWaysNode,r.active=!0,r.method=s;for(var a,c=n(s);!(a=c()).done;){for(var d,l=90,u=n(a.value);!(d=u()).done;){var h=d.value,f=cc.instantiate(this.cardsSmall.get(h));f.parent=r,f.x=t,f.y=l,f.interactable=!0,f.active=!0,l+=this.cardSmallWidth}t+=this.cardSmallWidth}r.on("click",function(t){cc.utils.gameNetworkingManager.takeChiAction(t.node.method,e.sessionKey),e.hideActionList(),e.hiderTimer(cc.utils.roomInfo.my_seat_id),e.sessionKey=null},this),t+=15}cc.utils.roomInfo.chiWaysNode.x-=t,cc.utils.roomInfo.chiWaysNode.active=!0}},showHideTiCard:function(e){if(1!==e)for(var t,i=n(2===e?this.cardsAlreadyUsedNext:this.cardsAlreadyUsedPrev);!(t=i()).done;){var o=t.value;if("ti"===o.type&&"back"===o.nodes[3].name){var s=o.nodes[3].x,r=o.nodes[3].y;o.nodes[3].destroy(),o.nodes[3]=cc.instantiate(this.cardsSmall.get(o.cards[3])),o.nodes[3].x=s,o.nodes[3].y=r,o.nodes[3].parent=o.nodes[2].parent,o.nodes[3].active=!0}}},renderHoleCards:function(e){void 0===e&&(e=19);var t=Math.ceil(e/2);19===e&&(t=9),this.backCards=[],this.backCardsLast=t-1,this.backCardsCulm=0;for(var n=this.baseCardNode.getPosition(),i=0;i<t;++i)this.backCards.push(cc.instantiate(this.baseCardNode)),this.backCards[i].parent=this.cardSetNode,this.backCards[i].setPosition(n.x,n.y+2*i),this.backCards[i].active=!0},clearUsedCards:function(e){for(var t,i=n(e);!(t=i()).done;)for(var o,s=n(t.value.nodes);!(o=s()).done;)o.value.destroy()},clearDiscardedCards:function(e){for(var t,i=n(e);!(t=i()).done;)t.value.destroy()},resetEverything:function(){this.cardGroupsNodes&&this.clearAllCardNodes(),this.cardGroupsNodes=[],this.cardsGroups=[],console.log(this.cardsAlreadyUsedMySelf,this.cardsDiscardedMySelf),this.clearUsedCards(this.cardsAlreadyUsedMySelf),this.clearUsedCards(this.cardsAlreadyUsedPrev),this.clearUsedCards(this.cardsAlreadyUsedNext),this.clearDiscardedCards(this.cardsDiscardedMySelf),this.clearDiscardedCards(this.cardsDiscardedPrev),this.clearDiscardedCards(this.cardsDiscardedNext),this.cardsAlreadyUsedMySelf=[],this.cardsAlreadyUsedPrev=[],this.cardsAlreadyUsedNext=[],this.cardsDiscardedMySelf=[],this.cardsDiscardedPrev=[],this.cardsDiscardedNext=[],this.cardsAlreadyChoseToNotUse=[],this.currentOnBoardCardNode&&(this.currentOnBoardCardNode.removeAllChildren(!1),this.currentOnBoardCardNode.destroy(),this.currentOnBoardCardNode=null),cc.utils.roomInfo.huInfo=null,cc.utils.userInfo.currentXi=0;for(var e=0;e<3;++e)this.seats[e].xi.string="0";this.currentState=0},processLoginData:function(){if(!1!==cc.utils.roomInfo.relogin){this.exitButton.active=!1,this.resetEverything();for(var e=0;e<3;++e){var t=cc.utils.roomInfo.playersInfo[e],i=e===cc.utils.roomInfo.my_seat_id?1:e===this.nextPlayerId?2:0,o=this.cardsAlreadyUsedMySelf,s=this.cardsAlreadyUsedMySelfNode,r=this.cardsDiscardedMySelf,a=this.cardsDiscardedMySelfNode,c=!1,d=!0;if(e===this.nextPlayerId)o=this.cardsAlreadyUsedNext,s=this.cardsAlreadyUsedNextNode,r=this.cardsDiscardedNext,a=this.cardsDiscardedNextNode,c=!0,d=!0;else if(e===this.prevPlayerId)o=this.cardsAlreadyUsedPrev,s=this.cardsAlreadyUsedPrevNode,r=this.cardsDiscardedPrev,a=this.cardsDiscardedPrevNode,c=!1,d=!1;else{this.renderHoleCards(cc.utils.roomInfo.numberOfHoleCards),this.remainNumofCardNode.active=!0,this.remainNumofCardLabel.string=cc.utils.roomInfo.numberOfHoleCards.toString(),this.cardsAlreadyChoseToNotUse=Array.from(t.cardsChooseToNotUsed);for(var l=0;l<3;++l)this.seats[l].ready.active=!1;this.cardsOnHand=new Map(cc.utils.roomInfo.cardsOnHand);var u=cc.utils.gameAlgo.groupCards(this.cardsOnHand);this.renderCardsOnHand(u),this.processOperation(t),cc.utils.userInfo.currentXi=t.xi}this.setSeatInfo(i,!1,t.nickname,t.xi,t.score,t.online,!1);for(var h,f=n(t.cardsAlreadyUsed);!(h=f()).done;){var p=h.value;this.addUsedCards(o,s,p.cards,p.type,p.xi,c)}for(var g,m=n(t.cardsDiscarded);!(g=m()).done;){var v=g.value;this.addDiscardedCard(r,a,v,d)}}}else{for(var y=0;y<cc.utils.roomInfo.other_players.length;++y){var _=cc.utils.roomInfo.other_players[y];_.seat_id===this.nextPlayerId?this.setSeatInfo(2,!1,_.nickname,0,0,!0):this.setSeatInfo(0,!1,_.nickname,0,0,!0)}cc.utils.gameNetworkingManager.checkIfGameReady()}},processOperation:function(e){if(e.operation){var t=parseInt((Date.now()-e.operation.startTime)/1e3);if("operation"===e.operation.type){this.sessionKey=e.operation.sessionKey;var n=!1;if(!0===e.operation.isDealed)this.dealHoleCard(e.operation.opCard,e.operation.op_seat_id);else{n=!0;var i=e.operation.op_seat_id===this.prevPlayerId,o=e.operation.op_seat_id===this.nextPlayerId?2:0;this.shootCardOthers(e.operation.opCard,o,i)}var s=this.calculateAvailableActions(e.operation.opCard,n,e.operation.op_seat_id,e.operation.isCheckHu);s.length>0?(this.showTimer(cc.utils.roomInfo.my_seat_id,t),this.renderActionsList(s)):(cc.utils.gameNetworkingManager.takeGuoAction(!1,this.sessionKey),this.sessionKey=null)}else if(this.showTimer(cc.utils.roomInfo.my_seat_id,t),1===e.operation.is_last_card_dealed){console.log("checkHu  in need_shoot  ",this.cardsAlreadyUsedMySelf,this.cardsOnHand);var r=cc.utils.gameAlgo.checkHu(this.cardsAlreadyUsedMySelf,this.cardsOnHand),a=[];r&&!0===r.status&&(a.push("hu"),this.currentDealShootInfo.op_seat_id===cc.utils.roomInfo.my_seat_id&&(r.huInfo.push("\u81ea\u6478"),r.tun+=1),cc.utils.roomInfo.number_of_wang>0&&(r.huInfo.push("\u738b"+cc.utils.roomInfo.number_of_wang.toString()),r.fan+=4*cc.utils.roomInfo.number_of_wang),cc.utils.roomInfo.huResult=r),a.length>0?(a.push("guo"),this.renderActionsList(a),this.currentState=3):this.currentState=1}else this.currentState=1}}}),cc._RF.pop()},{}],Net:[function(e,t){"use strict";cc._RF.push(t,"c67baIDiShFh4/KPZ2AgEis","Net"),null==window.io&&(window.io=e("socket-io")),cc.Class({extends:cc.Component,statics:{ip:"",sio:null,isPinging:!1,fnDisconnect:null,handlers:{},addHandler:function(e,t){if(this.handlers[e])console.log("event:"+e+"' handler has been registered.");else{var n=function(n){"disconnect"!=e&&"string"==typeof n&&(n=JSON.parse(n)),t(n)};this.handlers[e]=n,this.sio&&(console.log("register:function "+e),this.sio.on(e,n))}},connect:function(e){var t=this;for(var n in this.sio=window.io.connect(this.ip,{reconnection:!1,"force new connection":!0,transports:["websocket","polling"]}),this.sio.on("reconnect",function(){console.log("reconnection")}),this.sio.on("connect",function(n){t.sio.connected=!0,this.startHearbeat(),e(n)}.bind(this)),this.sio.on("disconnect",function(){console.log("disconnect"),this.lastRecieveTime=null,t.sio.connected=!1,t.close()}),this.sio.on("connect_failed",function(){console.log("connect_failed")}),this.handlers){var i=this.handlers[n];"function"==typeof i&&("disconnect"==n?this.fnDisconnect=i:(console.log("register:function "+n),this.sio.on(n,i)))}},startHearbeat:function(){this.sio.on("game_pong",function(){console.log("game_pong"),e.lastRecieveTime=Date.now(),e.delayMS=e.lastRecieveTime-e.lastSendTime,console.log(e.delayMS)}),this.lastRecieveTime=Date.now();var e=this;console.log(1),e.isPinging||(e.isPinging=!0,cc.game.on(cc.game.EVENT_HIDE,function(){e.ping()}),e.pingInterval=setInterval(function(){e.sio&&e.ping()}.bind(this),5e3),e.checkInterval=setInterval(function(){console.log("self.lastRecieveTime  ",e.lastRecieveTime),e.sio&&null!==e.lastRecieveTime&&Date.now()-e.lastRecieveTime>1e4&&(console.log("omg... trying to close ws"),e.lastRecieveTime=null,e.close(),clearInterval(e.checkInterval),clearInterval(e.pingInterval))}.bind(this),500))},send:function(e,t){console.log("sio send",e,t,this.sio.connected),this.sio.connected&&(null!=t&&"object"==typeof t&&(t=JSON.stringify(t)),null==t&&(t=""),this.sio.emit(e,t))},ping:function(){this.sio&&(this.lastSendTime=Date.now(),this.send("game_ping"))},close:function(){console.log("close"),this.delayMS=null,this.sio&&this.sio.connected&&(this.sio.connected=!1,this.sio.disconnect()),this.sio=null,this.fnDisconnect&&(this.fnDisconnect(),this.fnDisconnect=null)},test:function(e){cc.utils.http.sendRequest("/isServerOn",{},function(t){e(0==t.errcode)})}}}),cc._RF.pop()},{"socket-io":void 0}],ReConnection:[function(e,t){"use strict";cc._RF.push(t,"53295A70cBLNKIcAnRpLl8/","ReConnection"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},onEnable:function(){cc.utils.mainGame.node.on("login_result",function(e){cc.utils.wc.hide(),0==e.errcode&&!0===e.relogin||(cc.utils.roomInfo=null,cc.director.loadScene("RoomChoice")),cc.utils.roomInfo={room_id:e.room_id,my_seat_id:e.seat_id,playersInfo:e.playersInfo,cardsOnHand:e.cardsOnHand,numberOfHoleCards:e.numberOfHoleCards,number_of_wang:e.number_of_wang,current_played_games:e.current_played_games,total_games:e.total_games,relogin:!0},console.log(e),cc.utils.mainGame.processLoginData(),this.node.active=!1}.bind(this)),cc.utils.wc.show("\u6b63\u5728\u91cd\u8fde..."),function e(){cc.utils.net.test(function(t){if(t){var n=cc.utils.roomInfo.room_id;null!=n&&cc.utils.joinRoom(n)}else setTimeout(e,5e3)})}()},want_to_test:function(){console.log("hello")},start:function(){}}),cc._RF.pop()},{}],RoomChoice:[function(e,t){"use strict";cc._RF.push(t,"f9323NccwJOxolqgGoVJwiy","RoomChoice"),cc.Class({extends:cc.Component,properties:{waitingConnection:cc.Node,joinGameWindow:cc.Node,createRoomWindow:cc.Node,checkbox6Rounds:cc.Sprite,checkbox12Rounds:cc.Sprite,uncheckedSprite:cc.SpriteFrame,checkedSprite:cc.SpriteFrame},onLoad:function(){cc.utils.joinRoom=this.joinRoom,cc.utils.main.setFitScreenMode(),this.initEventHandlers(),this.selected6Rounds=!1,this.on6RoundsSelected()},initEventHandlers:function(){cc.utils.gameNetworkingManager.dataEventHandler=this.node,this.node.on("login_result",function(e){console.log("login_result arrived",e),0===e.errcode&&(!0===e.relogin?cc.utils.roomInfo={room_id:e.room_id,my_seat_id:e.seat_id,playersInfo:e.playersInfo,cardsOnHand:e.cardsOnHand,numberOfHoleCards:e.numberOfHoleCards,number_of_wang:e.number_of_wang,current_played_games:e.current_played_games,total_games:e.total_games,relogin:!0}:cc.utils.roomInfo={room_id:e.room_id,my_seat_id:e.seat_id,other_players:e.other_players,relogin:!1},cc.utils.wc.hide(),cc.director.loadScene("PaohuZiGame"))})},onCreateRoomClicked:function(){this.createRoomWindow.active=!0},onJoinRoomClicked:function(){this.joinGameWindow.active=!0},onCloseCreateRoomClicked:function(){this.createRoomWindow.active=!1},onCloseJoinRoomClicked:function(){this.joinGameWindow.active=!1},onCreateRoomConfirmButtonClicked:function(){var e=this,t=6;this.selected6Rounds||(t=12),cc.utils.http.sendRequest("/createRoom",{username:cc.utils.userInfo.username,token:cc.utils.userInfo.token,num_of_games:t},function(t){console.log(t),0===t.errcode?e.joinRoom(t.room_id):cc.utils.alert.show("\u63d0\u793a",t.errmsg)}.bind(this))},joinRoom:function(e){cc.utils.gameNetworkingManager.connectToGameServer({username:cc.utils.userInfo.username,token:cc.utils.userInfo.token,room_id:e,time:Date.now()})},on6RoundsSelected:function(){console.log("on6RoundsSelected"),this.selected6Rounds||(this.selected6Rounds=!0,this.checkbox6Rounds.spriteFrame=this.checkedSprite,this.checkbox12Rounds.spriteFrame=this.uncheckedSprite)},on12RoundsSelected:function(){console.log("on12RoundsSelected"),this.selected6Rounds&&(this.selected6Rounds=!1,this.checkbox6Rounds.spriteFrame=this.uncheckedSprite,this.checkbox12Rounds.spriteFrame=this.checkedSprite)}}),cc._RF.pop()},{}],RoomManagerUtil:[function(e,t){"use strict";cc._RF.push(t,"8b98fjiOYRF6YvyKYtmCaUW","RoomManagerUtil"),cc._RF.pop()},{}],Utils:[function(e,t){"use strict";cc._RF.push(t,"07e7fdPl0REq5XybOY99ea/","Utils"),cc.Class({extends:cc.Component,properties:{},addClickEvent:function(e,t,n,i){console.log(n+":"+i);var o=new cc.Component.EventHandler;o.target=t,o.component=n,o.handler=i,e.getComponent(cc.Button).clickEvents.push(o)},addSlideEvent:function(e,t,n,i){var o=new cc.Component.EventHandler;o.target=t,o.component=n,o.handler=i,e.getComponent(cc.Slider).slideEvents.push(o)},addEscEvent:function(e){cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyPressed:function(){},onKeyReleased:function(e){e==cc.KEY.back&&cc.vv.alert.show("\u63d0\u793a","\u786e\u5b9a\u8981\u9000\u51fa\u6e38\u620f\u5417\uff1f",function(){cc.game.end()},!0)}},e)},setFitScreenMode:function(){var e=cc.find("Canvas"),t=cc.view.getFrameSize(),n=t.width,i=t.height,o=e.getComponent(cc.Canvas);n/i>o.designResolution.width/o.designResolution.height?(o.fitHeight=!0,o.fitWidth=!1):(o.fitHeight=!1,o.fitWidth=!0)}}),cc._RF.pop()},{}],WaitingConnection:[function(e,t){"use strict";cc._RF.push(t,"9c66cFYHNNLg710XrNY7p24","WaitingConnection"),cc.Class({extends:cc.Component,properties:{target:cc.Node,_isShow:!1,lblContent:cc.Label},onLoad:function(){if(null==cc.utils)return null;cc.utils.wc=this,this.node.active=this._isShow},update:function(e){this.target.angle=this.target.angle-45*e},show:function(e){this._isShow=!0,this.node&&(this.node.active=this._isShow),this.lblContent&&(null==e&&(e=""),this.lblContent.string=e)},hide:function(){this._isShow=!1,this.node&&(this.node.active=this._isShow)}}),cc._RF.pop()},{}],"use_v2.1-2.2.1_cc.Toggle_event":[function(e,t){"use strict";cc._RF.push(t,"ada71qWbJFENo33xqQRiWuG","use_v2.1-2.2.1_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_isChecked=!0),cc._RF.pop()},{}]},{},["Alert","AppStart","BackgroundScaler","CreateRole","GameAlgorithm","GameAudioEffect","GameNetworkingManager","GameOver","HTTPUtil","JoinGameInput","Loading","Login","MainGame","Net","ReConnection","RoomChoice","RoomManagerUtil","Utils","WaitingConnection","use_v2.1-2.2.1_cc.Toggle_event"]);